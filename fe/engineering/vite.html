<!DOCTYPE html>
<html lang="cn-ZH" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vite ä»å…¥é—¨åˆ°ç²¾é€šï¼Œç©è½¬æ–°æ—¶ä»£å‰ç«¯æ„å»ºæ³•åˆ™ | ğŸ’ Cherryçš„åšå®¢</title>
    <meta name="description" content="ğŸ’ Cherryçš„åšå®¢">
    <link rel="preload stylesheet" href="/Cherry-blog/assets/style.33ca4ca6.css" as="style">
    <script type="module" src="/Cherry-blog/assets/app.4a9292c3.js"></script>
    <link rel="preload" href="/Cherry-blog/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/Cherry-blog/assets/chunks/framework.48867dda.js">
  <link rel="modulepreload" href="/Cherry-blog/assets/chunks/theme.9489cc21.js">
  <link rel="modulepreload" href="/Cherry-blog/assets/fe_engineering_vite.md.d4ff8168.lean.js">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-2bf54a99><!--[--><!--]--><!--[--><span tabindex="-1" data-v-f5a352f2></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-f5a352f2> Skip to content </a><!--]--><!----><header class="VPNav" data-v-2bf54a99 data-v-283c37a7><div class="VPNavBar has-sidebar" data-v-283c37a7 data-v-2264840b><div class="container" data-v-2264840b><div class="title" data-v-2264840b><div class="VPNavBarTitle has-sidebar" data-v-2264840b data-v-d298091b><a class="title" href="/Cherry-blog/" data-v-d298091b><!--[--><!--]--><!----><!--[-->ğŸ’ Cherryçš„åšå®¢<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-2264840b><div class="curtain" data-v-2264840b></div><div class="content-body" data-v-2264840b><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-2264840b><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-2264840b data-v-f54c34e6><span id="main-nav-aria-label" class="visually-hidden" data-v-f54c34e6>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Cherry-blog/fe/default/html.html" tabindex="0" data-v-f54c34e6 data-v-bdc88584 data-v-d502cd7b><!--[-->å‰ç«¯åŸºç¡€<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/Cherry-blog/fe/engineering/vite.html" tabindex="0" data-v-f54c34e6 data-v-bdc88584 data-v-d502cd7b><!--[-->å·¥ç¨‹åŒ–<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Cherry-blog/fe/resource/index.html" tabindex="0" data-v-f54c34e6 data-v-bdc88584 data-v-d502cd7b><!--[-->èµ„æºåˆé›†<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-2264840b data-v-0088fcc3><label title="toggle dark mode" data-v-0088fcc3 data-v-6efeb7e0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-6efeb7e0 data-v-5c77962f><span class="check" data-v-5c77962f><span class="icon" data-v-5c77962f><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-6efeb7e0><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-6efeb7e0><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-2264840b data-v-f8334a3a data-v-c74e4df9><!--[--><a class="VPSocialLink" href="https://github.com/zrtch" aria-label="github" target="_blank" rel="noopener" data-v-c74e4df9 data-v-d6790091><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-2264840b data-v-206ebc7c data-v-529736ff><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-529736ff><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-529736ff><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-529736ff><div class="VPMenu" data-v-529736ff data-v-280e28cb><!----><!--[--><!--[--><!----><div class="group" data-v-206ebc7c><div class="item appearance" data-v-206ebc7c><p class="label" data-v-206ebc7c>Appearance</p><div class="appearance-action" data-v-206ebc7c><label title="toggle dark mode" data-v-206ebc7c data-v-6efeb7e0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-6efeb7e0 data-v-5c77962f><span class="check" data-v-5c77962f><span class="icon" data-v-5c77962f><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-6efeb7e0><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-6efeb7e0><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><div class="group" data-v-206ebc7c><div class="item social-links" data-v-206ebc7c><div class="VPSocialLinks social-links-list" data-v-206ebc7c data-v-c74e4df9><!--[--><a class="VPSocialLink" href="https://github.com/zrtch" aria-label="github" target="_blank" rel="noopener" data-v-c74e4df9 data-v-d6790091><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-2264840b data-v-47edab87><span class="container" data-v-47edab87><span class="top" data-v-47edab87></span><span class="middle" data-v-47edab87></span><span class="bottom" data-v-47edab87></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-2bf54a99 data-v-b59ad933><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b59ad933><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b59ad933><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b59ad933>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-b59ad933 data-v-c20a59a7><button data-v-c20a59a7>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-2bf54a99 data-v-c7a7361d><div class="curtain" data-v-c7a7361d></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-c7a7361d><span class="visually-hidden" id="sidebar-aria-label" data-v-c7a7361d> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-c7a7361d><section class="VPSidebarItem level-0 has-active" data-v-c7a7361d data-v-b1f1ab92><div class="item" role="button" tabindex="0" data-v-b1f1ab92><div class="indicator" data-v-b1f1ab92></div><h2 class="text" data-v-b1f1ab92>å·¥ç¨‹åŒ–</h2><!----></div><div class="items" data-v-b1f1ab92><!--[--><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-b1f1ab92 data-v-b1f1ab92><div class="item" data-v-b1f1ab92><div class="indicator" data-v-b1f1ab92></div><a class="VPLink link link" href="/Cherry-blog/fe/engineering/vite.html" data-v-b1f1ab92 data-v-d502cd7b><!--[--><p class="text" data-v-b1f1ab92>Vite</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-2bf54a99 data-v-e1441724><div class="VPDoc has-sidebar has-aside" data-v-e1441724 data-v-e031c361><!--[--><!--]--><div class="container" data-v-e031c361><div class="aside" data-v-e031c361><div class="aside-curtain" data-v-e031c361></div><div class="aside-container" data-v-e031c361><div class="aside-content" data-v-e031c361><div class="VPDocAside" data-v-e031c361 data-v-6db944aa><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-6db944aa data-v-12ef9dee><div class="content" data-v-12ef9dee><div class="outline-marker" data-v-12ef9dee></div><div class="outline-title" data-v-12ef9dee>å¿«é€Ÿå¯¼èˆª</div><nav aria-labelledby="doc-outline-aria-label" data-v-12ef9dee><span class="visually-hidden" id="doc-outline-aria-label" data-v-12ef9dee> Table of Contents for current page </span><ul class="root" data-v-12ef9dee data-v-df1a6cf2><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-6db944aa></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e031c361><div class="content-container" data-v-e031c361><!--[--><!--]--><!----><main class="main" data-v-e031c361><div style="position:relative;" class="vp-doc _Cherry-blog_fe_engineering_vite" data-v-e031c361><div><h1 id="vite-ä»å…¥é—¨åˆ°ç²¾é€š-ç©è½¬æ–°æ—¶ä»£å‰ç«¯æ„å»ºæ³•åˆ™" tabindex="-1">Vite ä»å…¥é—¨åˆ°ç²¾é€šï¼Œç©è½¬æ–°æ—¶ä»£å‰ç«¯æ„å»ºæ³•åˆ™ <a class="header-anchor" href="#vite-ä»å…¥é—¨åˆ°ç²¾é€š-ç©è½¬æ–°æ—¶ä»£å‰ç«¯æ„å»ºæ³•åˆ™" aria-label="Permalink to &quot;Vite ä»å…¥é—¨åˆ°ç²¾é€šï¼Œç©è½¬æ–°æ—¶ä»£å‰ç«¯æ„å»ºæ³•åˆ™&quot;">â€‹</a></h1><h2 id="vite-çš„æ¦‚è¦ä»‹ç»" tabindex="-1">Vite çš„æ¦‚è¦ä»‹ç» <a class="header-anchor" href="#vite-çš„æ¦‚è¦ä»‹ç»" aria-label="Permalink to &quot;Vite çš„æ¦‚è¦ä»‹ç»&quot;">â€‹</a></h2><ul><li>å¼€å‘æ—¶æ•ˆç‡æé«˜</li><li>å¼€ç®±å³ç”¨ï¼ŒåŠŸèƒ½å®Œå¤‡</li><li>ç¤¾åŒºä¸°å¯Œï¼Œå…¼å®¹ rollup</li><li>è¶…é«˜é€Ÿçƒ­é‡è½½</li><li>é¢„è®¾åº”ç”¨å’Œç±»åº“æ‰“åŒ…æ¨¡å¼</li><li>å‰ç«¯ç±»åº“æ— å…³</li></ul><p>æ„å»ºæ˜¯ç°åœ¨å‰ç«¯é€ƒä¸å¼€çš„è¯é¢˜</p><ul><li>å‰ç«¯æ¡†æ¶æ—¶ä»£</li><li>å‰ç«¯åº”ç”¨è¶Šæ¥è¶Šå¤æ‚</li><li>å­¦ä¹ æ„å»ºå°±æ˜¯æå‡è‡ªå·±é‡è¦çš„è¿‡ç¨‹</li></ul><p><img src="https://raw.githubusercontent.com/zrtch/blog-img/master/1669970276973-67a2cbab-2437-498e-8a7e-21ebce890226.png" alt="image.png"> åœ¨ Vite å½“ä¸­ï¼Œæˆ‘ä»¬çš„è¯·æ±‚å‘å‘å¸ƒåˆ° Vite çš„ Server ä¹‹åï¼Œæˆ‘ä»¬ä¼šç»è¿‡ Server App ç„¶åä¼šç»è¿‡å®ƒä¸€å¤§æ®µçš„ ModuleGraph çš„æ¨¡å—ç®¡ç†ï¼Œç„¶åä¼šæ³¨å…¥å„ç§æ’ä»¶çš„åŠŸèƒ½ï¼Œæœ€åé€šè¿‡ Esbuild ä¿å­˜åˆ°å®ƒçš„ä¸€ä¸ªç¼“å­˜å½“ä¸­ï¼Œè¿”å›ç»™æˆ‘ä»¬çš„ç”¨æˆ· ã€‚</p><h3 id="_1-2-ä»€ä¹ˆæ˜¯-vite" tabindex="-1">1-2 ä»€ä¹ˆæ˜¯ Vite <a class="header-anchor" href="#_1-2-ä»€ä¹ˆæ˜¯-vite" aria-label="Permalink to &quot;1-2 ä»€ä¹ˆæ˜¯ Vite&quot;">â€‹</a></h3><p>å®˜ç½‘ï¼š<a href="https://cn.vitejs.dev/guide/" target="_blank" rel="noreferrer">https://cn.vitejs.dev/guide/</a> v2 ç‰ˆæœ¬å°±è½¬ä¸ºä¸ Vue æ— å…³ ä¼˜ç‚¹</p><ul><li>ä½¿ç”¨ç®€å•ï¼šåŸºæœ¬èƒ½æŠŠå°è£…çš„é…ç½®éƒ½å°è£…æ‰äº†ï¼Œä½¿ç”¨ä¸Šä¼šæ¯” vue-cliï¼Œcreate-react-appï¼Œwebpack ç®€å•çš„å¤š</li><li>å¿«ï¼šåœ¨å¼€å‘æ—¶æ˜¯èƒ½è®©ä½ æ„Ÿå—æ²¡æœ‰ç¼–è¯‘è¿‡ç¨‹çš„ï¼ŒåŸºæœ¬ä¸Šå¯åŠ¨é¡¹ç›®å°±ä¸¤ä¸‰ç§’ï¼Œå®æ—¶çœ‹è§é¡µé¢çš„æ›´æ–°</li><li>ä¾¿äºæ‰©å±•ï¼šå®ƒæœ¬èº«æ˜¯å…¼å®¹ Rollup æ’ä»¶çš„ï¼›è¿™äº›æ’ä»¶åœ¨ Vite åŸºæœ¬ä¸Šéƒ½èƒ½ç›´æ¥ä½¿ç”¨çš„ï¼Œ æ‹¥æœ‰äº†éå¸¸æˆç†Ÿçš„å·¥å…·çš„å¤§éƒ¨åˆ†ç”Ÿæ€ï¼›æ‰©å±•èƒ½åŠ›å¾ˆå¼ºã€‚</li></ul><p>å¸‚é¢ä¸Šä¹Ÿæœ‰ç±»ä¼¼çš„å·¥å…·ï¼š</p><ul><li>Snopackï¼šå’Œ Vite åœ¨ç”Ÿäº§æ„å»ºæ—¶æœ‰ç‚¹åŒºåˆ«ï¼ŒVite çš„ç”Ÿäº§æ„å»ºæ˜¯ç›´æ¥ç”¨ Rollup ç›´æ¥æ‰“åŒ…ï¼Œè€Œ Snopack çš„æ‰“åŒ…è¾“å‡ºè·Ÿå¼€å‘æ—¶äº‹ä¸€æ ·çš„ï¼Œè¿™ä¼šå¯¼è‡´æµè§ˆå™¨çš„å…¼å®¹æ€§æœ‰ä¸€ç‚¹é—®é¢˜ã€‚</li><li>WMRï¼šåŸºæœ¬æ˜¯ä»¥ Preact ä½œä¸ºé›†æˆçš„ï¼Œå¯¹ç¬¬ä¸‰æ–¹æ¡†æ¶å°±æ²¡é‚£ä¹ˆå‹å¥½</li><li>@web/dev-server ï¼šå®ƒæ²¡æœ‰æä¾›å®˜æ–¹çš„æ¡†æ¶é›†æˆï¼Œæ‰€ä»¥è¦é€šè¿‡ç¬¬ä¸‰æ–¹æ’ä»¶æ¥æ‰‹åŠ¨çš„å»åšï¼Œå¹¶ä¸”ä½¿ç”¨ç‡ä¸é«˜ï¼Œæ‰€ä»¥å®ƒçš„æ’ä»¶é›†æˆä¹Ÿæ²¡æœ‰é‚£ä¹ˆä¸°å¯Œï¼Œå¯¼è‡´å¹¶ä¸å¥½ç”¨ã€‚</li></ul><p>è¯¦æƒ…å¯ä»¥çœ‹å®˜ç½‘æ¯”è¾ƒï¼š<a href="https://cn.vitejs.dev/guide/comparisons.html" target="_blank" rel="noreferrer">https://cn.vitejs.dev/guide/comparisons.html</a></p><h3 id="_1-3-vite-å¯¹æ¯”å…¶ä»–æ„å»ºå·¥å…·çš„ä¼˜åŠ¿" tabindex="-1">1-3 Vite å¯¹æ¯”å…¶ä»–æ„å»ºå·¥å…·çš„ä¼˜åŠ¿ <a class="header-anchor" href="#_1-3-vite-å¯¹æ¯”å…¶ä»–æ„å»ºå·¥å…·çš„ä¼˜åŠ¿" aria-label="Permalink to &quot;1-3 Vite å¯¹æ¯”å…¶ä»–æ„å»ºå·¥å…·çš„ä¼˜åŠ¿&quot;">â€‹</a></h3><p>Vite å¯¹äº webpack å’Œ rollup æ˜¯ä¸ªæ›´ High Level çš„å·¥å…·ï¼›æ˜¯ä¸ºäº†é¡¹ç›®æ„å»ºè€Œç”Ÿçš„ï¼›è€Œä¸æ˜¯å•çº¯çš„ js æ„å»º</p><ul><li>High Level APIï¼› è€Œå¯¹åº”çš„ webpack æ˜¯ Low Level APIã€‚</li><li>Vite ä¸åŒ…å«è‡ªå·±ç¼–è¯‘èƒ½åŠ› ï¼Œè‡ªèº«ä¸å‚ä¸ç¼–è¯‘ï¼›åªæ˜¯é›†æˆäº† Rollup åŠŸèƒ½ï¼›å¯åŠ¨äº† dev-serveï¼›å¸®æˆ‘ä»¬ä¸­é—´è¿›è¡Œä¸€ä¸ªä¸²è”ï¼›å»ç®¡ç†è¿™äº›æ¨¡å—çš„å›¾è°±ï¼›å»ç›‘å¬æ–‡ä»¶çš„æ›´æ–°æ¥è¿›è¡Œ HMR çš„æ¨é€ã€‚</li><li>å¼€å‘æ—¶å®Œå…¨åŸºäº ESM åŠ è½½æ–¹å¼ã€‚</li></ul><p>Webpackï¼šä»–ç›¸å½“äºæ˜¯ build å·¥å…·ï¼Œä»–å¸Œæœ›æŠŠæ‰€æœ‰çš„å¯ä»¥è€ƒè™‘çš„åŠ è½½çš„å…¨éƒ¨åŠ è½½è¿›å»ï¼›åŒæ—¶ä»–ä¹Ÿå¸Œæœ›ä»–çš„æ ¸å¿ƒåŠŸèƒ½å¸®åŠ©å…¶ä»–çš„åŠŸèƒ½æ¥è¿›è¡Œå®ç°ï¼›æ¯”å¦‚å¯ä»¥åŸºäº webpack å»å®ç°ä¸€ä¸ª webpack-dev-serverï¼›ä¹Ÿæœ‰å„ç§ä¸åŒç¼–è¯‘çš„æ–¹å¼ Rollupï¼šä»–æ˜¯ä¸€ä¸ªé›†ä¸­å¼ï¼Œæ›´åŠ ä¸“ä¸€çš„å·¥å…·ï¼›è¯ç”Ÿçš„ç›®çš„å°±æ˜¯ä¸ºäº† Build ESM çš„ Moduleï¼›ç„¶ååŒæ—¶ä»–æ˜¯åªä¸“æ³¨äº build Javascriptï¼Œè€Œä¸é è°±å¹³å°çš„è¿™ä¹ˆä¸€ä¸ªå·¥å…·ï¼›ä»–ä¸ä¼šæœ‰ä¸“æœ‰çš„å‡½æ•°åœ¨é‡Œé¢ï¼Œä¼šéµå¾ª ESM çš„æ ‡å‡†ï¼Œç„¶åå®ƒ build å‡ºæ¥çš„ä»£ç å°±ç¬¦åˆåƒæˆ‘ä»¬éœ€è¦çš„ common.js çš„ module æ ‡å‡†ï¼Œå®ƒçš„ç›®æ ‡æ›´å¤šçš„æ˜¯ä¸ºäº†å·¥å…·ç±»åº“æ¥å»ä½¿ç”¨çš„ï¼Œæœ€åˆçš„åˆè¡·å°±æ²¡æœ‰ä¸ºäº†æ™®é€šçš„å‰ç«¯é¡¹ç›®æ¥æœåŠ¡ã€‚ Viteï¼šä»–çš„ç›®æ ‡æ˜¯æˆ‘ä»¬é¡¹ç›®å¼€å‘ï¼Œä¸åƒ webpack å’Œ rollup æ˜¯ä¸€ä¸ªå·¥å…·ï¼›ç„¶åæ‰§è¡Œæ˜¯æ„å»ºï¼Œvite å°±æ›´åŠ çš„ä¸Šå±‚ï¼Œä»–æ˜¯æƒ³è¦å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„æ›´æ–¹ä¾¿çš„å¼€å‘ä¸€ä¸ªé¡¹ç›®ï¼Œåˆè¡·å°±æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œå¿«é€Ÿï¼Œä½“éªŒæ›´å¥½ã€‚ webpack æ›´å…¨é¢ï¼›rollup æ›´ä¸“ä¸€ï¼›vite æ›´å¥½ç”¨ å‡å°‘äº†å¾ˆå¤šé…ç½®é‡ï¼š</p><ul><li>dev-serverï¼švite å°±è‡ªåŠ¨é›†æˆäº† dev-serverï¼›vite çš„æ ¸å¿ƒå†…å®¹ä¹Ÿæ˜¯ dev-serverï¼›å¦‚æœç”¨ webpack dev server åŸºæœ¬æ˜¯é€ƒä¸æ‰çš„ã€‚</li><li>å„ç±» loaderï¼šä¸éœ€è¦é…ç½®å„ç±» loaderï¼›æ¯”å¦‚è¯´åœ¨ webpack æˆ‘ä»¬è¦é…ç½® css loader style loaderï¼Œjs çš„ double loaderï¼Œå„ç§å„æ ·çš„ loaderï¼›åƒè¿™äº› vite åŸºæœ¬ç»™ä½ å†…ç½®äº†ï¼›ä»–ä¹Ÿæ˜¯é€šè¿‡æ’ä»¶çš„å½¢å¼ç»™ä½ å»åšçš„ï¼Œåªæ˜¯æå‰ç»™ä½ é¢„è®¾å¥½äº†ï¼›å¼€ç®±å³ç”¨ã€‚</li><li>build å‘½ä»¤ï¼šå¯ä»¥ build ä¸€ä¸ªç±»åº“ï¼Œä¹Ÿå¯ä»¥ build ä¸€ä¸ªé¡¹ç›®ï¼›build çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯çº¯ç²¹çš„ rollup</li></ul><h3 id="_1-5ã€è®¨è®ºé¢˜ã€‘è°ˆè°ˆä½ å¯¹äºæ„å»ºå·¥å…·å¾—è®¤è¯†" tabindex="-1">1-5ã€è®¨è®ºé¢˜ã€‘è°ˆè°ˆä½ å¯¹äºæ„å»ºå·¥å…·å¾—è®¤è¯† <a class="header-anchor" href="#_1-5ã€è®¨è®ºé¢˜ã€‘è°ˆè°ˆä½ å¯¹äºæ„å»ºå·¥å…·å¾—è®¤è¯†" aria-label="Permalink to &quot;1-5ã€è®¨è®ºé¢˜ã€‘è°ˆè°ˆä½ å¯¹äºæ„å»ºå·¥å…·å¾—è®¤è¯†&quot;">â€‹</a></h3><p>èŠä¸€èŠå„ä½è‡ªå·±é…ç½®è¿‡çš„æ„å»ºå·¥å…·ï¼Œç›´æ¥ç”¨ vue-cli æˆ–è€… create-react-app çš„ä¸ç®—å•Šï¼Œéœ€è¦çŸ¥é“åº•å±‚å·¥å…·ï¼Œå¹¶ä¸”è¿›è¡Œè¿‡é…ç½®ï¼Œæ­é…å‘½ä»¤å¯åŠ¨æˆ–è€…è„šæœ¬å¯åŠ¨ã€‚å¯ä»¥èŠèŠä½ ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªå·¥å…·ï¼Œæœ‰ä»€ä¹ˆå¥½å¤„æœ‰ä»€ä¹ˆä¸å¥½ç”¨çš„åœ°æ–¹ã€‚</p><ul><li>å¦‚æœæ²¡æœ‰ç”¨è¿‡ï¼Œå¯ä»¥è‡ªå·±å°è¯•åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ç”¨ webpack å’Œ rollup ä¸€èµ·é…ç½®ä¸€ä¸‹</li><li>å¯ä»¥å»æœç´¢â€”ä¸‹æœ‰å“ªäº›ä¸»æµçš„æ„å»ºå·¥å…·</li><li>webpack çš„ç”Ÿæ€æœ€ä¸ºä¸°å¯Œ</li><li>rollup çš„å¤§åŒ…ç»“æœæ›´ç¬¦åˆå¸¸è§„ js</li><li>parcel æœ€ä¸ºç®€å•</li></ul><h2 id="vite-çš„åŸºç¡€åº”ç”¨" tabindex="-1">Vite çš„åŸºç¡€åº”ç”¨ <a class="header-anchor" href="#vite-çš„åŸºç¡€åº”ç”¨" aria-label="Permalink to &quot;Vite çš„åŸºç¡€åº”ç”¨&quot;">â€‹</a></h2><h3 id="_2-1-vite-çš„ä¼˜åŠ¿" tabindex="-1">2-1 Vite çš„ä¼˜åŠ¿ <a class="header-anchor" href="#_2-1-vite-çš„ä¼˜åŠ¿" aria-label="Permalink to &quot;2-1 Vite çš„ä¼˜åŠ¿&quot;">â€‹</a></h3><ul><li>ä¸Šæ‰‹éå¸¸ç®€å•</li><li>å¼€å‘æ•ˆç‡æé«˜</li><li>ç¤¾åŒºæˆæœ¬ä½ï¼ˆå…¼å®¹ rollup æ’ä»¶ï¼‰</li></ul><p>webpack çš„é…ç½®ä¼šåŒ…å«ï¼š</p><ul><li>entryï¼šå°±æ˜¯ä½ è¦ç¼–è¯‘å“ªå‡ ä¸ªæ–‡ä»¶</li><li>outputï¼šä½ çš„æ–‡ä»¶è¾“å‡ºåœ¨å“ªé‡Œ</li><li>moduleï¼šå°±æ˜¯ä½ çš„ jsx è¦é€šè¿‡ babel è¿›è¡Œä¸€ä¸ªç¼–è¯‘</li><li>pluginsï¼šå°±æ˜¯ä½ çš„ html é€šè¿‡ HtmlWeboackPlugin æ¥ç”Ÿæˆçš„</li></ul><p>è€Œåè§‚ vite çš„é…ç½®åªéœ€è¦å‡ è¡Œä»£ç ï¼š</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> reactRefresh </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-react-refresh</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨reactRefreshè¿™ä¸ªæ’ä»¶å°±èƒ½è®©viteæ”¯æŒreactå¹¶ä¸”èƒ½æä¾›éå¸¸å®Œå–„çš„hot modlue reload(çƒ­åŠ è½½)çš„åŠŸèƒ½</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">reactRefresh</span><span style="color:#A6ACCD;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>æ›´åˆç†çš„ç±»æ¯”</p><ul><li>creat-react-app éœ€è¦æ‰§è¡Œ ejectï¼›æ¥æŠŠæ‰€æœ‰çš„ç»™ä½ åšå¥½çš„é…ç½®ç»™ä½ è¾“å‡ºåˆ°æ–‡ä»¶æ ¹ç›®å½•ä¸‹ï¼Œéå¸¸ä¸æ–¹ä¾¿</li><li>vue-cli çš„ configureWebpack å’Œ chainWebpack å»ä¿®æ”¹ webpack çš„é…ç½®</li><li>vite æœ‰è‡ªèº«çš„æ’ä»¶ç³»ç»Ÿï¼›åœ¨ç”Ÿæ€ä¸­åˆå…¼å®¹äº† rollup æ’ä»¶ï¼›åŸºç¡€èƒ½åŠ›å·²ç»éå¸¸å¼ºå¤§äº†</li><li>rollup å®˜æ–¹æ’ä»¶ï¼š<a href="https://github.com/rollup/plugins" target="_blank" rel="noreferrer">https://github.com/rollup/plugins</a></li></ul><p>ä¼ ç»Ÿçš„ webpack å¯åŠ¨æ–¹å¼ï¼šä»å…¥å£æ–‡ä»¶ entry å¼€å§‹ï¼Œå°±æŠŠæ‰€æœ‰çš„æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª Bundleï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯éå¸¸çš„æ…¢ï¼Œå› ä¸ºæ–‡ä»¶ä¼šéå¸¸çš„å¤šï¼› <img src="https://raw.githubusercontent.com/zrtch/blog-img/master/1670209898206-09142aed-b2f9-40d8-93a3-0b7d2d07dfc7.png" alt="image.png"> Vite çš„å¯åŠ¨æ–¹å¼ï¼šåœ¨å¯åŠ¨çš„æ—¶å€™é¢„ç¼–è¯‘ï¼Œéœ€è¦ç¼–è¯‘çš„æ–‡ä»¶ä»–åšä¸€äº›ç¼–è¯‘ï¼›åˆæ¬¡è®¿é—®æ—¶ï¼Œåªéœ€è¦é¦–é¡µç”¨åˆ°çš„è¿™äº›æ–‡ä»¶ï¼Œè¿™äº›æ¨¡å—è¿™äº›ç»„ä»¶ï¼Œè€Œä¸éœ€è¦æŠŠæ•´ä¸ªåº”ç”¨å…¨éƒ¨åŠ è½½ä¸‹æ¥ï¼Œè¿™å°±èŠ‚çœäº†éå¸¸å¤šåŠ è½½çš„å†…å®¹ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿä¸éœ€è¦ç¼–è¯‘è¿™äº›æ–‡ä»¶ï¼Œæ‰€ä»¥ä»–ä¼šè¿™ä¹ˆçš„å¿«ã€‚ä»–çš„å¿«è¿˜æœ‰å¦å¤–ä¸€ä¸ªåŸå› å°±æ˜¯ä½¿ç”¨äº† Esbuildï¼Œè¿™ä¸ªå·¥å…·åœ¨è¿è¡Œå¼€å‘ç¯å¢ƒçš„æ—¶å€™ï¼Œä»–ä¼šç”¨è¿™ä¸ªè¿›è¡Œæ–‡ä»¶çš„ç¼–è¯‘ï¼Œè€Œä»–çš„è¿è¡Œæ•ˆç‡å’Œæ€§èƒ½æ˜¯æ¯” webpack å’Œ rollup é«˜éå¸¸å¤šçš„ã€‚<img src="https://raw.githubusercontent.com/zrtch/blog-img/master/1670221028524-da7c8e31-7819-4c26-9afa-1a97b000d9ee.png" alt="image.png"></p><h3 id="_2-2-vite-åˆ›å»º-vue3-é¡¹ç›®" tabindex="-1">2-2 Vite åˆ›å»º Vue3 é¡¹ç›® <a class="header-anchor" href="#_2-2-vite-åˆ›å»º-vue3-é¡¹ç›®" aria-label="Permalink to &quot;2-2 Vite åˆ›å»º Vue3 é¡¹ç›®&quot;">â€‹</a></h3><p><code>pnpm create vite </code> å®‰è£…ä¾èµ–æ—¶å°½é‡åˆ«ä½¿ç”¨ npm webpack å’Œ rollup æ˜¯ä»¥ js æ–‡ä»¶ä½œä¸º entry çš„ï¼Œå¯¹äº vite ä»–çš„ç¼–è¯‘å…¥å£æ˜¯ä¸ª html æ–‡ä»¶ï¼Œè®©æµè§ˆå™¨åŠ è½½ html æ–‡ä»¶ï¼Œåœ¨é€šè¿‡ script æ ‡ç­¾åŠ è½½ main.jsï¼Œè¿™ä¸ª js çš„è¯·æ±‚åˆ°äº† vite çš„ server ä¹‹åï¼Œvite å»æŸ¥æ‰¾è¿™æ–‡ä»¶ç„¶åæ‰ä¼šå¯¹ä»–è¿›è¡Œä¸€ä¸ªç¼–è¯‘ã€‚ vite.config.jsï¼šå­˜æ”¾æˆ‘ä»¬çš„å¯¹äºçš„ vite é…ç½®çš„åœ°æ–¹</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// å¦‚æœæƒ³ä½¿ç”¨jsxå°±å¾—å®‰è£…å¦ä¸€ä¸ªä¾èµ–</span></span>
<span class="line"><span style="color:#A6ACCD;">pnpm i </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">vitejs</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">vue</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">jsx </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç„¶ååœ¨vite.confing.jså¼•å…¥å¹¶ä¸”ä½¿ç”¨å®ƒ</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> vueJsx </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-vue-jsx</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">vue</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">vueJsx</span><span style="color:#A6ACCD;">()]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h3 id="_2-3-vite-åˆ›å»º-vue2-çš„é¡¹ç›®" tabindex="-1">2-3 Vite åˆ›å»º Vue2 çš„é¡¹ç›® <a class="header-anchor" href="#_2-3-vite-åˆ›å»º-vue2-çš„é¡¹ç›®" aria-label="Permalink to &quot;2-3 Vite åˆ›å»º Vue2 çš„é¡¹ç›®&quot;">â€‹</a></h3><p>Vue2 å¹¶æ²¡æœ‰å‡ºç°åœ¨é»˜è®¤åˆ—è¡¨ï¼›Vue &lt;2.7 çš„æ”¯æŒï¼š<a href="https://github.com/underfin/vite-plugin-vue2" target="_blank" rel="noreferrer">underfin/vite-plugin-vue2</a></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// é¦–å…ˆå®‰è£…å®ƒï¼›ä¹Ÿè¦å®‰è£…vue2.0çš„ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#A6ACCD;">npm install vite</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">plugin</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">vue2 </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç„¶ååœ¨ vite.config.js å¼•å…¥ä½¿ç”¨</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createVuePlugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-vue2</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">createVuePlugin</span><span style="color:#A6ACCD;">(</span><span style="color:#676E95;font-style:italic;">/* options */</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>å½“ç„¶ä¹Ÿå¯ä»¥è®¿é—®ï¼š<a href="https://github.com/vitejs/awesome-vite#plugins" target="_blank" rel="noreferrer">https://github.com/vitejs/awesome-vite#plugins</a>å°±èƒ½çœ‹åˆ°ä¸€äº›å…³ç³»å…¶ä»–ä¸åŒæ¡†æ¶çš„æ’ä»¶ å°±æ‹¿ vue2 æ¥è¯´å¯ä»¥ç›´æ¥å…‹éš†å®ƒçš„é¡¹ç›®ä½œä¸ºé¡¹ç›®å¯åŠ¨ï¼š<a href="https://github.com/logue/vite-vue2-ts-starter" target="_blank" rel="noreferrer">https://github.com/logue/vite-vue2-ts-starter</a></p><h3 id="_2-4-vite-åˆ›å»º-react-çš„é¡¹ç›®" tabindex="-1">2-4 Vite åˆ›å»º React çš„é¡¹ç›® <a class="header-anchor" href="#_2-4-vite-åˆ›å»º-react-çš„é¡¹ç›®" aria-label="Permalink to &quot;2-4 Vite åˆ›å»º React çš„é¡¹ç›®&quot;">â€‹</a></h3><p>ä½¿ç”¨æ’ä»¶çš„åç§°å«ï¼šFastRefreshï¼Œè§£å†³äº†å¾ˆå¤š react-hot-loader æ— æ³•è§£å†³çš„é—®é¢˜ï¼Œå¹¶ä¸”é€Ÿåº¦æ›´å¿«ï¼›æ”¯æŒå±€éƒ¨æ›´æ–° å®˜æ–¹æ’ä»¶åœ°å€ï¼š<a href="https://www.npmjs.com/package/@vitejs/plugin-react" target="_blank" rel="noreferrer">https://www.npmjs.com/package/@vitejs/plugin-react</a></p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// å…ˆæ‰§è¡Œå®‰è£…å‘½ä»¤ï¼›ç„¶åé€‰æ‹©reactç‰ˆæœ¬ pnpm create vite //</span></span>
<span class="line"><span style="color:#A6ACCD;">åœ¨index.htmlé‡Œé¢çš„main.jsx</span></span>
<span class="line"><span style="color:#A6ACCD;">ä¼šç»è¿‡ä¸€ç³»åˆ—çš„ç¼–è¯‘ï¼Œè¿”å›jsçš„å†…å®¹ï¼›åªå…³å¿ƒè¿”å›çš„å†…å®¹æ˜¯ä¸æ˜¯js</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/main.jsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><h3 id="_2-5-vite-ä¸­ä½¿ç”¨-css-çš„å„ç§åŠŸèƒ½" tabindex="-1">2-5 Vite ä¸­ä½¿ç”¨ CSS çš„å„ç§åŠŸèƒ½ <a class="header-anchor" href="#_2-5-vite-ä¸­ä½¿ç”¨-css-çš„å„ç§åŠŸèƒ½" aria-label="Permalink to &quot;2-5 Vite ä¸­ä½¿ç”¨ CSS çš„å„ç§åŠŸèƒ½&quot;">â€‹</a></h3><ol><li><strong>css variable</strong>ï¼šæ¨èæˆ‘ä»¬ä½¿ç”¨åŸç”Ÿ css variable æ¥å–è¿›è¡Œæ ·å¼ç»´æŠ¤ï¼›</li></ol><div class="language-css"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// </span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">root</span><span style="color:#A6ACCD;"> ä»£è¡¨çš„æ˜¯å‘½åç©ºé—´ï¼›åœ¨ä¸‹é¢å®šä¹‰çš„æ‰€æœ‰çš„å˜é‡ï¼›åœ¨æ¥ä¸‹æ¥æ‰€æœ‰çš„æ ·å¼çš„ç±»å½“ä¸­éƒ½å¯ä»¥å»ä½¿ç”¨</span></span>
<span class="line"><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">root</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  --main-bg-color</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> brown</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">// ä»£è¡¨æˆ‘ä»¬å¼•ç”¨äº†è¿™ä¸ªå˜é‡</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">root</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">color</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">var</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">--main-bg-color</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><ol start="2"><li><strong>postcss</strong>ï¼švite ä¹Ÿé›†æˆäº† postcssï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ–°å»º postcss.config.jsï¼Œ</li></ol><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@postcss-plugins/console</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">ç„¶ååœ¨cssä¸­ä½¿ç”¨å³å¯</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">root </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">hello</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">color</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">var</span><span style="color:#F07178;">(--</span><span style="color:#A6ACCD;">main</span><span style="color:#F07178;">-bg-color)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><ol start="3"><li><strong>@import alias</strong>ï¼šä½¿ç”¨@ è·¯å¾„æ˜ å°„æ¥å»å¿«é€Ÿçš„æŒ‡å‘ style ç›®å½•ï¼Œå°±ä¼šå¾ˆç®€å•ï¼›å½“ç„¶ vite ä¹Ÿæ˜¯åšäº†å¤„ç†çš„</li></ol><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// vite.config.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">vue</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">vueJsx</span><span style="color:#A6ACCD;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resolve</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  	</span><span style="color:#F07178;">alias</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">@styles</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/src/styles</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¿™æ ·å°±ä¸ç”¨ç›¸å¯¹è·¯å¾„äº†ï¼Œç›´æ¥@stylesä½¿ç”¨å³å¯</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./styles/index.css</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> ---&gt; import </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@styles/index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è€Œä¸”ä¸¤ä¸ªcssä¹‹é—´ä¹Ÿå¯ä»¥äº’ç›¸ä½¿ç”¨ï¼Œåªéœ€åœ¨other.css å®šä¹‰å¥½ä½ çš„æ ·å¼å³å¯</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">import </span><span style="color:#82AAFF;">url</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@styles/other.css</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><ol start="4"><li><strong>css-modules</strong>ï¼šæˆ‘ä»¬å¸Œæœ› css çš„ç±»åä¸æ˜¯çº¯ç²¹æ ¹æ®æˆ‘ä»¬å†™çš„é‚£ä¸ªç±»åï¼Œè€Œæ˜¯ä»–æœ‰ä¸ªæ˜ å°„å…³ç³»ï¼Œä»–ä¼šç»™æˆ‘ä»¬è¿›è¡Œä¸€ä¸ªç¼–è¯‘ï¼Œè¿™æ ·ç±»åå°±å˜æˆä¸€ä¸ªæ— æ„ä¹‰çš„äº†ï¼Œå¹¶ä¸”å¯ä»¥åšä¸€ä¸ªå­—ç¬¦ä¸²çš„æ”¶ç¼©ï¼ŒåŒæ—¶å¯ä»¥å»é‡ã€‚</li></ol><p>åªéœ€è¦åœ¨å®šä¹‰æ–‡ä»¶æ—¶åŠ ä¸Š .module å³å¯ï¼›test.module.css</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> classes </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@styles/test.module.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineComponent</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">={</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">root </span><span style="color:#89DDFF;">${</span><span style="color:#A6ACCD;">classes</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">moduleClass</span><span style="color:#89DDFF;">}`</span><span style="color:#89DDFF;">}&gt;</span><span style="color:#A6ACCD;">hello vue jsx</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><ol start="5"><li><strong>css pre-processsors</strong>ï¼šé¢„å¤„ç†çš„å·¥å…·ï¼Œåœ¨ vite å½“ä¸­ä¹Ÿæ˜¯æ”¯æŒçš„ï¼›æ¯”å¦‚æˆ‘ä»¬è¦ä½¿ç”¨ lessï¼Œæˆ‘ä»¬åªéœ€è¦å®‰è£…ä¸‹ lessï¼Œç„¶åå†å¯¹åº”çš„æ˜¯ç›®å½•ä¸‹æ–°å»º lessï¼Œæœ€ç»ˆä½¿ç”¨å®ƒå³å¯ã€‚</li></ol><div class="language-css"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">@bgColor</span><span style="color:#A6ACCD;">: red</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">root</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#B2CCD6;">background-color</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> @bgColor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_2-6-vite-ä¸­ä½¿ç”¨-typescript" tabindex="-1">2-6 Vite ä¸­ä½¿ç”¨ Typescript <a class="header-anchor" href="#_2-6-vite-ä¸­ä½¿ç”¨-typescript" aria-label="Permalink to &quot;2-6 Vite ä¸­ä½¿ç”¨ Typescript&quot;">â€‹</a></h3><p>å› ä¸º vite å¯¹äº ts åªæ˜¯ç¼–è¯‘è¯­æ³•ï¼›è€Œä¸æ˜¯ç¼–è¯‘æ–‡ä»¶ï¼›ä½¿ç”¨ tsc --noEmit æ¥å»åªåšæ ¡éªŒï¼Œä¸åšæ–‡ä»¶çš„è¾“å‡ºã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åœ¨buildçš„æ—¶å€™åŠ ä¸Š tsc --noEmit</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">dev</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tsc --noEmit &amp;&amp; vite build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">preview</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite preview</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span></span></code></pre></div><p>ç„¶åè¦æ–°å¢ tsconfig.json æ–‡ä»¶é‡Œè¿›è¡Œé…ç½®ï¼š<a href="https://www.jianshu.com/p/44b2a9cb98b5" target="_blank" rel="noreferrer">https://www.jianshu.com/p/44b2a9cb98b5</a> isolatedModulesï¼šæŒ‡å®šæ˜¯å¦å°†æ¯ä¸ªæ–‡ä»¶ä½œä¸ºå•ç‹¬çš„æ¨¡å—ï¼Œé»˜è®¤ä¸º trueï¼Œä»–ä¸å¯ä»¥å’Œ declaration åŒæ—¶è®¾å®šï¼›</p><ul><li>å¯¹äºè¿™ç§ç±»å‹çš„ export éœ€è¦è¿›è¡Œå¤„ç†</li><li>ä¸æ˜¯ä¸€ä¸ªæ¨¡å—çš„æ–‡ä»¶</li></ul><h3 id="_2-7-vite-ä¸­å¤„ç†é™æ€èµ„æºçš„æ–¹æ³•" tabindex="-1">2-7 Vite ä¸­å¤„ç†é™æ€èµ„æºçš„æ–¹æ³• <a class="header-anchor" href="#_2-7-vite-ä¸­å¤„ç†é™æ€èµ„æºçš„æ–¹æ³•" aria-label="Permalink to &quot;2-7 Vite ä¸­å¤„ç†é™æ€èµ„æºçš„æ–¹æ³•&quot;">â€‹</a></h3><p>vite æä¾›äº†å‡ ä¸ª import çš„å‚æ•°ï¼Œå¸®åŠ©æˆ‘ä»¬ä»¥å›ºå®šçš„æ–¹å¼å»å¼•å…¥è¿™ä¸ªæ–‡ä»¶</p><ul><li>urlï¼šæŠŠæ–‡ä»¶æ”¾åœ¨æŸä¸ªåœ°æ–¹ï¼Œè¿”å›æŸä¸ª url</li><li>rawï¼šæŠŠå®ƒçš„å­—ç¬¦ä¸²çš„å†…å®¹ç»™ä½ è¿”å›å›æ¥</li><li>worker / worker inlineï¼šè¿™ä¸ªç”¨äº webworkderï¼ˆå¸®åŠ©æˆ‘ä»¬æ›´é«˜æ€§èƒ½çš„æ„å»ºåº”ç”¨çš„å·¥å…·ï¼‰</li><li><a href="https://www.assemblyscript.org/introduction.html" target="_blank" rel="noreferrer">Web Assembly</a>ï¼šä¸€ç§å¾ˆç‰¹æ®Šçš„åœ¨æµè§ˆå™¨å¯ä»¥è¿è¡Œçš„äºŒè¿›åˆ¶çš„å†…å®¹ï¼›ç±»ä¼¼ ts çš„å·¥å…·</li></ul><div class="language-css"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// ?url å°±æŠŠæˆ‘ä»¬å½“å‰çš„è·¯å¾„è¿”å›äº†</span></span>
<span class="line"><span style="color:#A6ACCD;">import test from &#39;</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">/main?url&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">console.log(&#39;ğŸ¤©  test&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> test) // ğŸ¤©  test /src/</span><span style="color:#FFCB6B;">main</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">js</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">// ?raw å°±æŠŠæˆ‘ä»¬æ–‡ä»¶çš„ä»£ç ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å¼•å…¥è¿›æ¥</span></span>
<span class="line"><span style="color:#A6ACCD;">import test from &#39;</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">/main?raw&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">console.log(&#39;ğŸ¤©  test&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> test) //  import </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> createApp </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> from &#39;vue&#39; ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">// å¼•å…¥package</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">jsonæ–‡ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">import pkg from &#39;.</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">/package.json&#39;;</span></span>
<span class="line"><span style="color:#A6ACCD;">console.log(&#39;ğŸ¤©  pkg&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> pkg); // è¾“å‡ºå¯¹åº”ä¿¡æ¯</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">// ?worker</span></span>
<span class="line"><span style="color:#A6ACCD;">import Worker from &quot;</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">/worker?worker&quot;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">const worker = new Worker();</span></span>
<span class="line"><span style="color:#A6ACCD;">worker</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">onmessage</span><span style="color:#A6ACCD;"> = function (e) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  console.log(e)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">// æ‹¿åˆ° Web Assemblyï¼Œç„¶åä½¿ç”¨å®ƒï¼Œfib</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">wasm</span><span style="color:#A6ACCD;"> é€šè¿‡tsæ–‡ä»¶ç”Ÿæˆ</span></span>
<span class="line"><span style="color:#A6ACCD;">import init from &#39;</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">/fib.wasm&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">init()</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">then((m)=</span><span style="color:#89DDFF;">&gt;{</span></span>
<span class="line"><span style="color:#A6ACCD;">  console.log(m.fib(10))</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h3 id="_2-8-vite-é›†æˆ-eslint-å’Œ-prettier" tabindex="-1">2-8 Vite é›†æˆ eslint å’Œ prettier <a class="header-anchor" href="#_2-8-vite-é›†æˆ-eslint-å’Œ-prettier" aria-label="Permalink to &quot;2-8 Vite é›†æˆ eslint å’Œ prettier&quot;">â€‹</a></h3><p>eslintï¼šä¸“é—¨ç”¨æ¥è®¾ç½®è‡ªå®šä¹‰ä»£ç è§„åˆ™ã€‚<a href="https://www.jianshu.com/p/9445b232c54b" target="_blank" rel="noreferrer">https://www.jianshu.com/p/9445b232c54b</a> prettierï¼šä»£ç æ ¼å¼åŒ–å·¥å…·ã€‚<a href="https://prettier.io/" target="_blank" rel="noreferrer">https://prettier.io/</a> huskyï¼šGit Hook å·¥å…·ï¼Œå€ŸåŠ© husky åœ¨ git æäº¤è¿›è¡Œä¸€äº›è‡ªåŠ¨åŒ–æ“ä½œã€‚ <a href="https://blog.csdn.net/huangpb123/article/details/102690412" target="_blank" rel="noreferrer">husky ä»£ç è§„èŒƒ</a></p><h3 id="_2-9-vite-ä¸­å¾—-env-ç¯å¢ƒå˜é‡" tabindex="-1">2-9 Vite ä¸­å¾— env ç¯å¢ƒå˜é‡ <a class="header-anchor" href="#_2-9-vite-ä¸­å¾—-env-ç¯å¢ƒå˜é‡" aria-label="Permalink to &quot;2-9 Vite ä¸­å¾— env ç¯å¢ƒå˜é‡&quot;">â€‹</a></h3><ul><li>MODEï¼šæˆ‘ä»¬ç°åœ¨çš„æ¨¡å¼çš„åˆ†åŒº</li><li>BASE_URLï¼šæœ¬åœ°é“¾æ¥</li><li>PRODï¼šå½“ç„¶ç¯å¢ƒæ˜¯å¦æ˜¯æ­£å¼ç¯å¢ƒ</li><li>DEVï¼šå½“å‰ç¯å¢ƒæ˜¯å¦æ˜¯å¼€å‘ç¯å¢ƒ</li></ul><p>.env æ–‡ä»¶æœ‰ä¸åŒçš„åç¼€å°±ä¼šåœ¨ä¸åŒç¯å¢ƒä¸‹ç”¨åˆ°ï¼›.env.development å¼€å‘ç¯å¢ƒï¼›.env.production ç”Ÿäº§ç¯å¢ƒ</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">dev</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite --mode test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// é€šè¿‡ä¸åŒçš„modeæ¥è¿è¡Œä¸åŒçš„ç¯å¢ƒ</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span></code></pre></div><h2 id="vite-çš„é«˜çº§åº”ç”¨" tabindex="-1">Vite çš„é«˜çº§åº”ç”¨ <a class="header-anchor" href="#vite-çš„é«˜çº§åº”ç”¨" aria-label="Permalink to &quot;Vite çš„é«˜çº§åº”ç”¨&quot;">â€‹</a></h2><h3 id="_3-2-vite-ä¸­çš„-hmr-çƒ­æ›´æ–°åŠŸèƒ½" tabindex="-1">3-2 Vite ä¸­çš„ HMR çƒ­æ›´æ–°åŠŸèƒ½ <a class="header-anchor" href="#_3-2-vite-ä¸­çš„-hmr-çƒ­æ›´æ–°åŠŸèƒ½" aria-label="Permalink to &quot;3-2 Vite ä¸­çš„ HMR çƒ­æ›´æ–°åŠŸèƒ½&quot;">â€‹</a></h3><p>å°±æ¯”å¦‚æˆ‘ä»¬åœ¨ App.jsx é‡Œé¢æ–°å¢äº†ä¸€ä¸ª p æ ‡ç­¾ï¼Œä½†æ˜¯é¡µé¢ä¹Ÿä¼šé©¬ä¸Šæ›´æ–°è¿™ä¸ª p æ ‡ç­¾ï¼Œ å¹¶æ²¡æœ‰åˆ·æ–°é¡µé¢æŠ–åŠ¨çš„é‚£ä¸€ä¸‹ï¼Œè¿™å°±æ˜¯çƒ­æ›´æ–°ã€‚vite.config.js é‡Œé¢çš„ vueJsx è¿™ä¸ªæ’ä»¶å·²ç»ç»™æˆ‘ä»¬åŠ è¿›å»äº†ï¼Œ vueJsx() å·²ç»å®ç°æ‰äº†ã€‚ é¦–å…ˆè¿›å…¥é¡µé¢æœ‰ main.js çš„è¯·æ±‚ï¼Œç„¶åæ”¹å˜æ–‡ä»¶ä¹‹åï¼Œå°±ä¼šæœ‰ä¸ªæ–°çš„ main.js çš„è¯·æ±‚ï¼›æ–°çš„ main.js å°±ä¼šæ›¿æ¢è€çš„ main.jsï¼›ç„¶åå½¢æˆä¸€ä¸ªçƒ­æ›´æ–°çš„è¿‡ç¨‹ã€‚åœ¨ server ç«¯å‘ç°äº†æ•°æ®æ›´æ–°ï¼Œç„¶åä»–æ¨ä¸€ä¸ªäº‹ä»¶åˆ°å‰ç«¯æµè§ˆå™¨é‡Œï¼Œæµè§ˆå™¨çŸ¥é“æˆ‘ä»¬å“ªä¸ªæ–‡ä»¶æ›´æ–°äº†ï¼Œæˆ‘ä»¬å°±å»è¯·æ±‚è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åå»æ›¿æ¢æµè§ˆå™¨è€çš„æ¨¡å—ã€‚</p><h3 id="_3-3-vite-çš„-glob-import-æ‰¹é‡å¯¼å…¥åŠŸèƒ½" tabindex="-1">3-3 Vite çš„ glob-import æ‰¹é‡å¯¼å…¥åŠŸèƒ½ <a class="header-anchor" href="#_3-3-vite-çš„-glob-import-æ‰¹é‡å¯¼å…¥åŠŸèƒ½" aria-label="Permalink to &quot;3-3 Vite çš„ glob-import æ‰¹é‡å¯¼å…¥åŠŸèƒ½&quot;">â€‹</a></h3><p>glob-importï¼šé€šè¿‡ä¸€ç»„ç±»ä¼¼äºæ­£åˆ™è¡¨è¾¾å¼æ¥å¼•å…¥ä¸€ç»„çš„ js æ–‡ä»¶ã€‚æ¯”å¦‚åšå¤šè¯­è¨€çš„æ”¯æŒï¼Œå°±å¯ä»¥å¼•å…¥ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸Šé¢æ‰€æœ‰è¯­è¨€çš„ json æ–‡ä»¶ã€‚æ•´ä¸ª vite æä¾›è¿™ä¸ª globa-import çš„åŠŸèƒ½æ¥è‡ªäºç¬¬ä¸‰æ–¹çš„åº“<a href="https://github.com/mrmlnc/fast-glob" target="_blank" rel="noreferrer">fast-glob</a>ï¼Œè¿™ä¸ªåº“æä¾›äº† vite è®©æˆ‘ä»¬å¯ä»¥åŠ¨æ€åŒ¹é…å»å¼•å…¥å…·ä½“çš„ä¸€ä¸ªåŒ¹é…æ¨¡å¼çš„ä¸€ç³»åˆ—æ–‡ä»¶çš„æ–¹å¼ã€‚</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> globModules </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">glob</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./glob/*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// * ä»£è¡¨globæ–‡ä»¶å¤¹æ‰€æœ‰æ–‡ä»¶</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> globModules </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">glob</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./glob/*.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// *.js ä»£è¡¨æ‰€æœ‰jsæ–‡ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ğŸ¤©  globModules</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> globModules)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">entries</span><span style="color:#A6ACCD;">(globModules)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;font-style:italic;">k</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">v</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">v</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">m</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">k</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">default</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h3 id="_3-4-vite-æ€§èƒ½æ­ç§˜-é¢„ç¼–è¯‘ä¼˜åŒ–" tabindex="-1">3-4 Vite æ€§èƒ½æ­ç§˜---é¢„ç¼–è¯‘ä¼˜åŒ– <a class="header-anchor" href="#_3-4-vite-æ€§èƒ½æ­ç§˜-é¢„ç¼–è¯‘ä¼˜åŒ–" aria-label="Permalink to &quot;3-4 Vite æ€§èƒ½æ­ç§˜---é¢„ç¼–è¯‘ä¼˜åŒ–&quot;">â€‹</a></h3><p>é¢„ç¼–è¯‘ä½œç”¨ï¼šVite åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨ä¹‹å‰ä»–ä¼šå…ˆå»æŠŠè¿™äº›æˆ‘ä»¬æ‰€ä¾èµ–çš„è¿™äº›åŒ…è¿›è¡Œä¸€ä¸ªç¼–è¯‘ï¼Œç„¶åæ”¾åˆ°ä¸€ä¸ª catch é‡Œé¢ï¼Œä¹‹åæˆ‘ä»¬æ‰€æœ‰ç”¨åˆ°ç¬¬ä¸‰æ–¹åº“çš„åŒ…å°±ä¼šç›´æ¥ä» catch é‡Œé¢å–ã€‚ é¢„ç¼–è¯‘è¿‡ç¨‹ä¸­æœ‰ä¸ªéå¸¸é‡è¦çš„äº‹æƒ…ï¼šæŠŠé ESModule çš„æ–‡ä»¶ç»™ä»–ç¼–è¯‘æˆ ESModuleï¼Œå› ä¸ºåœ¨æˆ‘ä»¬å¼€å‘çš„æ—¶å€™ï¼Œvite æ˜¯ä¾èµ–æµè§ˆå™¨è¿œç¨‹çš„ ESModule çš„åŠ è½½æ–¹å¼å»åŠ è½½æ–‡ä»¶çš„ã€‚ å¦‚æœç”¨äº†ç¬¬ä¸‰æ–¹çš„æ’ä»¶ï¼Œç¬¬ä¸‰æ–¹å¸®ä½ å¢åŠ äº†ä¸€äº›ä¾èµ–ï¼Œè€Œè¿™äº›ä¾èµ–åˆä¸æ˜¯ ESModule çš„ä¾èµ–ï¼Œè¿™ä¸ªæ—¶å€™ vite åœ¨é¡¹ç›®å¯åŠ¨åˆæœŸæ˜¯å‘ç°ä¸äº†æˆ‘ä»¬ä¾èµ–çš„è¿™ä¸ªæ–‡ä»¶çš„ï¼Œå› ä¸ºå®ƒæ˜¯ç”±æ’ä»¶äº§ç”Ÿçš„ï¼Œå¯ä»¥åŠ åˆ°é…ç½®é¡¹é‡Œé¢</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">optimizeDeps</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">exclude</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>é¢„ç¼–è¯‘è¿˜æœ‰ä¸ªåŠŸèƒ½ï¼šå°±æ˜¯æŠŠé›¶æ•£çš„æ–‡ä»¶ç»™ä½ æ‰“åŒ…åˆ°ä¸€èµ·ã€‚ è¿›å…¥é¡¹ç›®çš„æ—¶å€™åœ¨ network é‡Œï¼Œæ¯”å¦‚ react.js å°±ä¼šè®¾ç½®ï¼šCache-Control: max-age=31536000,immutableï¼Œè¿™æ ·æˆ‘ä»¬æµè§ˆå™¨å°±ä¸ç”¨é‡æ–°å‘é€è¯·æ±‚ï¼Œè€Œå¯ä»¥ç›´æ¥ä½¿ç”¨æµè§ˆå™¨çš„ç¼“å­˜ã€‚ å¦‚æœé¡¹ç›®é‡Œé¢çš„ main.js æˆ‘ä»¬æ²¡æ”¹å˜å°±æ˜¯ï¼šcache-control: no-cacheã€‚</p><h3 id="_3-5-åœ¨é-node-æœåŠ¡ä¸­é›†æˆ-vite" tabindex="-1">3-5 åœ¨é Node æœåŠ¡ä¸­é›†æˆ Vite <a class="header-anchor" href="#_3-5-åœ¨é-node-æœåŠ¡ä¸­é›†æˆ-vite" aria-label="Permalink to &quot;3-5 åœ¨é Node æœåŠ¡ä¸­é›†æˆ Vite&quot;">â€‹</a></h3><p>è¿™äº›æœåŠ¡ä¸æ˜¯è¿è¡Œ js çš„ã€‚æ¯”å¦‚ä¸€äº›ä¼ ç»Ÿçš„è€é¡¹ç›®ï¼Œä»–ä»¬çš„æ•°æ®æ˜¯è¦åç«¯æœåŠ¡çš„æ¨¡æ¿å¼•æ“æŠŠæ•°æ®å†™åˆ° html é‡Œé¢æ¥è¿›è¡Œè¿”å›çš„ï¼Œæ¯”å¦‚ä¸€äº›ä½¿ç”¨ JSTL çš„ java é¡¹ç›®ã€‚å…¥å£ html æ˜¯å­˜åœ¨ java é¡¹ç›®é‡Œé¢çš„ï¼Œå› ä¸ºä»–ä»¬è¦è§£æè¿™ä¸ªæ¨¡æ¿è¿”å›è¿™ä¸ª htmlï¼Œè€Œæˆ‘ä»¬å†™çš„å‰ç«¯åº”ç”¨å…³æ³¨çš„æ˜¯ js å¦‚ä½•åµŒå…¥åˆ°è¿™ä¸ª html é‡Œé¢æˆä¸ºä»–çš„ä¸€ä¸ªæ ‡ç­¾ï¼Œè¿™é‡Œé¢å°±ä¼šå­˜åœ¨å¼•å…¥è·¯å¾„çš„é—®é¢˜ï¼Œå› ä¸º vite æ˜¯ä¼šè‡ªåŠ¨å¼•å…¥è·¯å¾„çš„ï¼Œé‚£å¦‚æœ html æ˜¯åœ¨åˆ«çš„æœåŠ¡é‡Œé¢ï¼Œå°±æ²¡æœ‰äººå¸®åŠ©æˆ‘ä»¬å»åšè¿™ä¸ªäº‹æƒ…ã€‚</p><h3 id="_3-6-nodejs-é›†æˆ-vite-å¼€å‘æ—¶çš„-ssr" tabindex="-1">3-6 Nodejs é›†æˆ Vite å¼€å‘æ—¶çš„ SSR <a class="header-anchor" href="#_3-6-nodejs-é›†æˆ-vite-å¼€å‘æ—¶çš„-ssr" aria-label="Permalink to &quot;3-6 Nodejs é›†æˆ Vite å¼€å‘æ—¶çš„ SSR&quot;">â€‹</a></h3><p>å¯åŠ¨äº†ä¸€ä¸ª vite çš„ dev-serverï¼›åœ¨ nodejs ä¸­é›†æˆ vite çš„ dev-server æ–¹æ³•ï¼›é›†æˆ server å¤§éƒ¨åˆ†æƒ…å†µä¸‹å°±æ˜¯ä¸ºäº† ssr åœ¨ ssr æ¨¡å¼ä¸‹é¢ï¼Œå¯¹äºæˆ‘ä»¬çš„è¯·æ±‚çš„ç®¡ç†ä¼šè½¬äº¤ç»™æˆ‘ä»¬è‡ªå·±çš„ serverï¼Œè€Œä¸æ˜¯ç”± vite å»æä¾›ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯æ¸²æŸ“å‡º htmlï¼Œæä¾›ç»™ responseï¼Œ</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createRequire</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> require </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">createServer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> createViteServer </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">createViteServer</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">server</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">middlewareMode</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ssr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">vite</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">middlewares</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">4000</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h3 id="_3-7-node-é›†æˆæ­£å¼-build-çš„-vite-åº”ç”¨çš„-ssr" tabindex="-1">3-7 Node é›†æˆæ­£å¼ build çš„ Vite åº”ç”¨çš„ SSR <a class="header-anchor" href="#_3-7-node-é›†æˆæ­£å¼-build-çš„-vite-åº”ç”¨çš„-ssr" aria-label="Permalink to &quot;3-7 Node é›†æˆæ­£å¼ build çš„ Vite åº”ç”¨çš„ SSR&quot;">â€‹</a></h3><p><a href="https://cn.vitejs.dev/guide/ssr.html#setting-up-the-dev-server" target="_blank" rel="noreferrer">https://cn.vitejs.dev/guide/ssr.html#setting-up-the-dev-server</a></p><h3 id="_3-8-é€šè¿‡-ssr-åŠŸèƒ½å®ç°é™æ€ç«™ç‚¹å¯¼å‡º" tabindex="-1">3-8 é€šè¿‡ SSR åŠŸèƒ½å®ç°é™æ€ç«™ç‚¹å¯¼å‡º <a class="header-anchor" href="#_3-8-é€šè¿‡-ssr-åŠŸèƒ½å®ç°é™æ€ç«™ç‚¹å¯¼å‡º" aria-label="Permalink to &quot;3-8 é€šè¿‡ SSR åŠŸèƒ½å®ç°é™æ€ç«™ç‚¹å¯¼å‡º&quot;">â€‹</a></h3><p><a href="https://cn.vitejs.dev/guide/static-deploy.html" target="_blank" rel="noreferrer">https://cn.vitejs.dev/guide/static-deploy.html</a></p><h3 id="_3-9-vite-é…ç½®é¡¹ä¸€è§ˆ" tabindex="-1">3-9 Vite é…ç½®é¡¹ä¸€è§ˆ <a class="header-anchor" href="#_3-9-vite-é…ç½®é¡¹ä¸€è§ˆ" aria-label="Permalink to &quot;3-9 Vite é…ç½®é¡¹ä¸€è§ˆ&quot;">â€‹</a></h3><p>å¸¸è§„é…ç½®é¡¹ï¼š<a href="https://cn.vitejs.dev/config/shared-options.html" target="_blank" rel="noreferrer">https://cn.vitejs.dev/config/shared-options.html</a> build é…ç½®ï¼š<a href="https://cn.vitejs.dev/config/build-options.html" target="_blank" rel="noreferrer">https://cn.vitejs.dev/config/build-options.html</a></p><h2 id="rollup-ç³»ç»Ÿå­¦ä¹ " tabindex="-1">Rollup ç³»ç»Ÿå­¦ä¹  <a class="header-anchor" href="#rollup-ç³»ç»Ÿå­¦ä¹ " aria-label="Permalink to &quot;Rollup ç³»ç»Ÿå­¦ä¹ &quot;">â€‹</a></h2><h3 id="_4-1-rollup-ä»‹ç»" tabindex="-1">4-1 Rollup ä»‹ç» <a class="header-anchor" href="#_4-1-rollup-ä»‹ç»" aria-label="Permalink to &quot;4-1 Rollup ä»‹ç»&quot;">â€‹</a></h3><p>éå¸¸æˆç†Ÿçš„å‰ç«¯æ„å»ºå·¥å…·ï¼Œrollup èƒ½å¤Ÿæ‰“åŒ…ä¸€ä¸ªå¤§éƒ¨åˆ†åœºæ™¯çš„ buildã€‚å¼€æºç±»åº“ä¼˜å…ˆé€‰æ‹©ï¼Œå®ƒæ˜¯ä½ ä»¥ ESM æ ‡å‡†ä¸ºç›®æ ‡çš„æ„å»ºå·¥å…·ã€‚æ‰“åŒ…çš„æ—¶å€™èƒ½å¤ŸæŠŠä¸€äº›ä¸éœ€è¦çš„ä»£ç ç»™ä»–å»æ‰ï¼Œå‡å°‘ä»£ç çš„æ–‡ä»¶å¤§å°ï¼Œæé«˜è¿è¡Œæ€§èƒ½ã€‚ é¦–å…ˆå…¨å±€å®‰è£…ï¼šcnpm i -g rollup</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åœ¨index.jsä¸­</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello rollup</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç„¶åè¿è¡Œå°±ä¼šè¾“å‡ºdist.jsæ–‡ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">rollup </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">i index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">file dist</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¾“å‡ºç»“æœç»™æˆ‘ä»¬åŒ…å«äº†ä¸€å¤§å—çš„å…³äºumdçš„æ¨¡å—ç®¡ç†çš„åŠŸèƒ½</span></span>
<span class="line"><span style="color:#A6ACCD;">rollup </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">i index </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">file dist</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">format umd</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// cjs: å°±ä¼šæ˜¯ requireçš„è¯­æ³•</span></span>
<span class="line"><span style="color:#A6ACCD;">rollup </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">i index </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">file dist</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">format cjs</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// esm: å°±å’Œæˆ‘ä»¬å¹³æ—¶ä»£ç é£æ ¼å·®ä¸å¤š</span></span>
<span class="line"><span style="color:#A6ACCD;">rollup </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">i index </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">file dist</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">format es</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// iife: å°±æ˜¯è‡ªæ‰§è¡Œçš„å‡½æ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">rollup </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">i index </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">file dist</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">format iife</span></span></code></pre></div><p>Tree Shakingï¼šå®ƒåªä¼šæ‰“åŒ…æˆ‘ä»¬ç”¨åˆ°çš„ä»£ç ï¼Œä¸ä¼šæ‰“åŒ…æ²¡æœ‰ç”¨åˆ°çš„ä»£ç ã€‚è¿™å°±éå¸¸æœ‰ç”¨äº†ï¼Œå› ä¸ºæ•´ä¸ªä»£ç ï¼Œå®é™…ä¸Šç”¨çš„ä¸€äº›ç¬¬ä¸‰æ–¹ç±»åº“ï¼Œå¯èƒ½åªç”¨åˆ°å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ä»–ä»¬çš„ç±»åº“å¾ˆå¤§ï¼Œ å¦‚æœæ‰“åŒ…çš„æ—¶å€™æŠŠæ‰€æœ‰çš„ä»£ç æ‰“åŒ…è¿›æ¥ï¼Œé‚£ä¹ˆæ•´ä¸ª js ä¼šæœ‰å¾ˆå¤šæˆ‘ä»¬ç”¨ä¸åˆ°çš„ä»£ç ï¼Œèƒ½å»æ‰è¿™éƒ¨åˆ†è‚¯å®šå¯¹æˆ‘ä»¬åº”ç”¨çš„æ€§èƒ½æœ‰å¾ˆå¤§çš„æå‡ã€‚è¿™å°±æ˜¯ Tree Shaking çš„ä½œç”¨ï¼Œä¹Ÿæ˜¯ rollup æœ€å¸å¼•äººçš„ã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// a.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> funA </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">A</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> funB </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">B</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åœ¨index.jsåªå¼•å…¥funA</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">funA</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./a</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#82AAFF;">funA</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello rollup</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç„¶ååœ¨æ‰§è¡Œrollup -i index --file dist.js --format esï¼›åªä¼šæœ‰funAçš„ä»£ç </span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> funA </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">A</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">funA</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello rollup</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h3 id="_4-2-es-module-è¯¦è§£" tabindex="-1">4-2 ES Module è¯¦è§£ <a class="header-anchor" href="#_4-2-es-module-è¯¦è§£" aria-label="Permalink to &quot;4-2 ES Module è¯¦è§£&quot;">â€‹</a></h3><p><img src="https://raw.githubusercontent.com/zrtch/blog-img/master/1670551169122-2f53f5d1-1a09-40ed-8f95-9c46336d2eb2.png" alt="img.png"> åœ¨å…·åå¯¼å…¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶è¿›è¡Œé‡å‘½åï¼Œæ¯”å¦‚ <code>import { useEffect as myUseEffect } from &quot;react&quot;</code>å°±å¯ä»¥åœ¨å¼•å…¥æ—¶ç»™å˜é‡è¿›è¡Œä¸€ä¸ªæ–°çš„å‘½åã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// è¿™é‡Œ * å¯¹åº”çš„å…¶å®å°±æ˜¯reactæ¨¡å—ä¸­æ‰€æœ‰å…·åå¯¼å‡º</span></span></code></pre></div><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// export çš„ä½¿ç”¨æ–¹å¼ç›¸å¯¹æ›´ä¸°å¯Œç‚¹</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> xxx </span><span style="color:#676E95;font-style:italic;">// é»˜è®¤å¯¼å‡º</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">joky</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// å…·åå¯¼å‡º</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> age </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">18</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">age</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// é›†åˆå½¢å¼çš„å…·åå¯¼å‡º</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">age</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Jock</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// å¯¼å‡ºå¹¶é‡å‘½å</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">another-module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// re- export é‡æ–°å¯¼å‡º</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">someValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">another-export</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// å…·åé‡æ–°å¯¼å‡º</span></span></code></pre></div><p>åœ¨ç½‘é¡µä¸Šä½¿ç”¨ ES Moduleï¼Œè¿™é‡Œçš„ type=&quot;module&quot; æ˜¯ä¸èƒ½çœç•¥çš„ï¼Œæµè§ˆå™¨åªä¼šå¯¹åŠ äº†è¿™ä¸ªå±æ€§çš„ js è„šæœ¬é‡‡ç”¨ ES Module çš„å½¢å¼è¿›è¡Œè§£æï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚åœ¨æµè§ˆå™¨è§£æå¹¶æ‰§è¡Œä¹‹åï¼Œå¯¹æ–‡ä»¶å†…çš„ import è¯­å¥ï¼Œæµè§ˆå™¨åˆ™ä¼šæ ¹æ®å…¶è·¯å¾„ç»§ç»­è¯·æ±‚å…¶ä¾èµ–çš„æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰çœŸæ­£è¢«ä¾èµ–çš„ js æ¨¡å—æ‰ä¼šè¢«çœŸæ­£çš„åŠ è½½ã€‚</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">srcipt</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/srx/main.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">srcipt</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>åŠ¨æ€åŠ è½½æ¨¡å—ï¼šES Module æä¾›äº†åŠ¨æ€å¯¼å…¥æ¨¡å—çš„å·¥å…·å‡½æ•°ï¼šimport()ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå¼•å…¥çš„æ¨¡å—è·¯å¾„ï¼Œæ¯”å¦‚ import(&quot;./router.js&quot;)å°±è¡¨ç¤ºç°åœ¨æˆ‘éœ€è¦åŠ è½½ router è¿™ä¸ªæ¨¡å—ã€‚è¯¥å‡½æ•°å°±è¿”å›ä¸€ä¸ª Promiseï¼Œå½“æ¨¡å—åŠ è½½æˆåŠŸä¹‹åä¼šè°ƒç”¨ thenï¼Œåä¹‹åˆ™è¿›å…¥ catchï¼Œåœ¨ then ä¸­æˆ‘ä»¬ä¼šæ‹¿åˆ°å¯¹åº”æ¨¡å—çš„æ‰€æœ‰å¯¼å‡ºï¼š</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./router.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">m</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sayHello</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>ES Module å’Œ Common JS æ¨¡å—çš„åŒºåˆ«</p><ul><li>Canmon JS æ¨¡å—é€šè¿‡ require å‡½æ•°å’Œ module å¯¹è±¡æ¥è¿›è¡Œæ¨¡å—ç®¡ç†ï¼Œè€Œè¿™ä¸¤ä¸ªå‡½æ•°åˆ™æ˜¯åœ¨ JS è„šæœ¬æ‰§è¡Œå‰ï¼Œæœ‰ JS å¼•æ“é€šè¿‡ VM è¿›è¡Œæ³¨å…¥çš„å…¨å±€æ—¶è±¡ï¼Œæœ¬è´¨ä¸Šä»–ä»¬å°±æ˜¯ JS çš„å‡½æ•°æˆ–è€…å¯¹è±¡ï¼Œå¯ä»¥åœ¨ä»»æ„ åœ°æ–¹è¢«å¼•ç”¨å’Œä½¿ç”¨ï¼Œä»–ä»¬è¿è¡Œçš„åŒæ—¶ä¹Ÿæ˜¯ JS è¿è¡Œçš„åŒæ—¶ã€‚</li><li>è€Œ ESModule çš„ import å’Œ export åˆ™ä¸åŒï¼Œä»–ä»¬æ˜¯å…³é”®å­—ï¼Œåœ¨è„šæœ¬è¢«è¯­æ³•è§£æè¿˜æ²¡æœ‰æ‰§è¡Œæ—¶ï¼Œå°±å·²ç»å¯ä»¥çŸ¥é“è¯¥æ¨¡å—å¯¼å…¥æˆ–è€…å¯¼å‡ºäº†ä»€ä¹ˆå†…å®¹ï¼Œæœ¬è´¨ä¸Šè¿™ä¸¤ä¸ªæ¨¡å—ç®¡ç†æ–¹å¼çš„æ‰§è¡Œæ—¶æœºå°±æ˜¯ä¸åŒçš„,</li><li>import å¯¼å…¥çš„å†…å®¹æ˜¯é™æ€çš„ä¸å…è®¸ä¿®æ”¹çš„</li><li>è€Œ require å¼•å…¥çš„å¯¹è±¡æœ¬èº«å°±æ˜¯åŸå§‹å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œä¿®æ”¹</li></ul><h3 id="_4-3-rollup-çš„å‘½ä»¤è¡Œä½¿ç”¨" tabindex="-1">4-3 Rollup çš„å‘½ä»¤è¡Œä½¿ç”¨ <a class="header-anchor" href="#_4-3-rollup-çš„å‘½ä»¤è¡Œä½¿ç”¨" aria-label="Permalink to &quot;4-3 Rollup çš„å‘½ä»¤è¡Œä½¿ç”¨&quot;">â€‹</a></h3><ul><li><code>rollup -v</code>ï¼šæŸ¥çœ‹ rollup ç‰ˆæœ¬</li><li><code>rollup -i index.js --file dist.js --format umd</code>ï¼š-i ä»£è¡¨è¾“å…¥æ–‡ä»¶ï¼›--file ä»£è¡¨è¾“å‡ºæ–‡ä»¶ï¼›--fromat ä»£è¡¨éœ€è¦è¾“å‡ºçš„æ–‡ä»¶ç±»å‹</li><li><code>rollup -i index.js -i a.js --dir dist</code>ï¼šå¤šä¸ªè¾“å…¥æ–‡ä»¶ï¼Œç„¶åè¾“å‡ºåˆ°æ–‡ä»¶å¤¹ <ul><li><code>rollup -i index.js --format iife</code>ï¼šè¾“å‡ºä¸ºè‡ªæ‰§è¡Œå‡½æ•°</li><li><code>rollup -i index.js --format cjs</code>ï¼šè¾“å‡ºä¸º Common JS ä»£ç </li><li><code>rollup -i index.js --format es</code>ï¼šæœ€æµè¡Œçš„ï¼Œé€šè¿‡ import å»å¼•å…¥æ¨¡å—çš„</li><li><code>rollup -i index.js --format umd</code>ï¼šæŠŠ CommonJSï¼ŒAMDï¼Œiife è¿™å‡ ç§è§„èŒƒæ”¾åœ¨ä¸€èµ·éƒ½å»å…¼å®¹çš„æ–‡ä»¶</li></ul></li><li><code>rollup -i index.js --file dist.js --format cjs --watch</code>ï¼šç›‘å¬æºæ–‡ä»¶</li><li><code>rollup -c rollup.config.js</code>ï¼šè¿è¡Œé…ç½®å¥½çš„ rollup.config.js æ–‡ä»¶</li><li><code>rollup --config rollup.config.js --environment MODE:loca</code>ï¼šenvironment åŒºåˆ†ç¯å¢ƒ</li><li>rollup æ’ä»¶ï¼š<a href="https://github.com/rollup/plugins" target="_blank" rel="noreferrer">https://github.com/rollup/plugins</a></li></ul><h3 id="_4-4-rollup-é…ç½®æ–‡ä»¶ä½¿ç”¨" tabindex="-1">4-4 Rollup é…ç½®æ–‡ä»¶ä½¿ç”¨ <a class="header-anchor" href="#_4-4-rollup-é…ç½®æ–‡ä»¶ä½¿ç”¨" aria-label="Permalink to &quot;4-4 Rollup é…ç½®æ–‡ä»¶ä½¿ç”¨&quot;">â€‹</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//åœ¨ package.jsoné‡Œé¢è¿›è¡Œé…ç½®</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	 </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ä¸ç„¶ä¼šæŠ¥é”™</span></span>
<span class="line"><span style="color:#F07178;">	  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rollup -c rollup.config.js</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><code> pnpm i @rollup/plugin-node-resolve</code><code>pnpm i rollup-plugin-terser</code></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> json </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@rollup/plugin-json</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> resolve </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@rollup/plugin-node-resolve</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> commonjs </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@rollup/plugin-commonjs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">terser</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup-plugin-terser</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">external</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// externalä½œç”¨å°±æ˜¯æœ‰äº›åŒ…æˆ‘ä»¬ä¸æƒ³è®©ä»–æ‰“åŒ…è¿›å»ï¼Œå°±å¯ä»¥è®¾ç½®</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">commonjs</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">json</span><span style="color:#A6ACCD;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">file</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist/index.es.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// æŒ‡å®šè¾“å‡ºç›®å½•dist</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">es</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">terser</span><span style="color:#A6ACCD;">()]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// åœ¨outputä¹Ÿå¯ä»¥ä½¿ç”¨pluginsï¼Œterserçš„ä½œç”¨å°±æ˜¯å‹ç¼©ä»£ç </span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">banner</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/** hello this is banner **/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// æ³¨é‡Šçš„ä½œç”¨</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">commonjs</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">json</span><span style="color:#A6ACCD;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">external</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">file</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist/index.umd.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">umd</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Index</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">banner</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/** hello this is banner **/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// æ³¨é‡Šçš„ä½œç”¨</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span></span></code></pre></div><h3 id="_4-5-rollup-æ’ä»¶åŠŸèƒ½è§£æ-ä¸Š" tabindex="-1">4-5 Rollup æ’ä»¶åŠŸèƒ½è§£æï¼ˆä¸Šï¼‰ <a class="header-anchor" href="#_4-5-rollup-æ’ä»¶åŠŸèƒ½è§£æ-ä¸Š" aria-label="Permalink to &quot;4-5 Rollup æ’ä»¶åŠŸèƒ½è§£æï¼ˆä¸Šï¼‰&quot;">â€‹</a></h3><p>rollup æ’ä»¶ï¼š<a href="https://github.com/rollup/plugins" target="_blank" rel="noreferrer">https://github.com/rollup/plugins</a> rollup çš„æ’ä»¶æœºåˆ¶ï¼šé€šè¿‡è¾“å…¥çš„å†…å®¹ï¼Œä¼šç»è¿‡ rollup æ ¸å¿ƒçš„ä»£ç çš„å¤„ç†ï¼Œæ¥ä¸‹æ¥é€šè¿‡è°ƒç”¨ä¸åŒçš„æ’ä»¶ï¼Œè¿›è¿‡è¿™äº›æ’ä»¶å¯¹è¿™ä¸ªä»£ç æˆ–è€…å¯¹æ–‡ä»¶å†…å®¹çš„å¤„ç†ï¼Œæœ€åå½¢æˆä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ emit file ä¹‹åï¼Œæ•´ä¸ªæ–‡ä»¶ build å°±ç»“æŸäº†ã€‚ Rollup Hookï¼ˆé’©å­ï¼‰ï¼šå¯¹åº”çš„ä¸åŒçš„èŠ‚ç‚¹ï¼Œä»–ä¼šä¸»åŠ¨å‹¾å‡ºåœ¨æ’ä»¶è®¾ç½®çš„å†…å®¹ç„¶åå®ƒå»è°ƒç”¨å®ƒå¾—åˆ°ä¸€ä¸ªæ–°çš„ç»“æœã€‚ é€šç”¨é…ç½®ï¼šincludeï¼›excludeã€‚ ä¸‰ä¸ªå®˜æ–¹æ’ä»¶ï¼š</p><ul><li>aliasï¼šæä¾›äº†ä¸ºæ¨¡å—èµ·åˆ«åçš„åŠŸèƒ½</li><li>babelï¼šè®©æˆ‘ä»¬æå‰ä½¿ç”¨ js çš„æ–°ç‰¹æ€§ï¼ŒæŠŠæœ€æ–°çš„è¯­æ³•è½¬ä¸º es5</li><li>replaceï¼šç”¨é€”æ˜¯åœ¨æ‰“åŒ…æ—¶åŠ¨æ€æ›¿æ¢ä»£ç ä¸­çš„å†…å®¹</li></ul><p>å¤§éƒ¨åˆ†çš„æ’ä»¶å¯ä»¥ç›´æ¥åœ¨ Vite ä¸­ç”¨ï¼Œå› ä¸ºä»–æ˜¯ç»§æ‰¿äº rollup æ’ä»¶çš„ å®‰è£… alias ï¼š<code>pnpm i @rollup/plugin-alias </code></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> alias </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@rollup/plugin-alias</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#82AAFF;">alias</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">entries</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">a</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#82AAFF;">commonjs</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#82AAFF;">json</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span></span></code></pre></div><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> resolve </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup-plugin-node-resolve</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> babel </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup-plugin-babel</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/main.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">babel</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">exclude</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node_modules/**</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// ä»…ä»…è½¬è¯‘æˆ‘ä»¬çš„æºç </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">dest</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bundle.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> replace </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup-plugin-replace</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">...,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">...,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">replace</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">__SAM__</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//å°†__SAM__æ›¿æ¢ä¸ºtrue</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_4-7-rollup-å¸¸ç”¨æ’ä»¶ç›˜ç‚¹" tabindex="-1">4-7 Rollup å¸¸ç”¨æ’ä»¶ç›˜ç‚¹ <a class="header-anchor" href="#_4-7-rollup-å¸¸ç”¨æ’ä»¶ç›˜ç‚¹" aria-label="Permalink to &quot;4-7 Rollup å¸¸ç”¨æ’ä»¶ç›˜ç‚¹&quot;">â€‹</a></h3><ul><li>rollup-plugin-commonjsï¼šç”¨äºå°† CommonJS æ¨¡å—è½¬æ¢ä¸º ES6 æ¨¡å—ï¼Œä»¥ä¾¿ Rollup å¯ä»¥å¤„ç†å®ƒä»¬ã€‚</li><li>rollup-plugin-node-resolveï¼šè§£æ npm æ¨¡å—çš„è·¯å¾„ï¼Œä»¥ä¾¿ Rollup å¯ä»¥æ‰¾åˆ°å®ƒä»¬ã€‚</li><li>rollup-plugin-terserï¼šå‹ç¼© JavaScript ä»£ç ï¼Œä»¥æé«˜æ€§èƒ½ã€‚</li><li>rollup-plugin-babelï¼šä½¿ç”¨ Babel ç¼–è¯‘ JavaScript ä»£ç ï¼Œä»¥æ”¯æŒæ›´æ–°çš„ JavaScript è¯­æ³•å’Œç‰¹æ€§ã€‚</li><li>rollup-plugin-replaceï¼šå¯ä»¥åœ¨æ‰“åŒ…æ—¶æ›¿æ¢æ¨¡å—ä¸­çš„å˜é‡ã€‚</li><li>TypeScriptï¼Œeslintï¼Œimageï¼Œstripï¼Œwasm</li></ul><h3 id="_4-8-esbuild-çš„ä½¿ç”¨æ•™ç¨‹" tabindex="-1">4-8 Esbuild çš„ä½¿ç”¨æ•™ç¨‹ <a class="header-anchor" href="#_4-8-esbuild-çš„ä½¿ç”¨æ•™ç¨‹" aria-label="Permalink to &quot;4-8 Esbuild çš„ä½¿ç”¨æ•™ç¨‹&quot;">â€‹</a></h3><p>esbuild ä½¿ç”¨ Go è¯­è¨€å¼€å‘ï¼Œ æ²¡æœ‰é…ç½®æ–‡ä»¶è¿™ä¸ªæ¦‚å¿µï¼›ä¸èƒ½ç¼–è¯‘åˆ° es5</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// å®‰è£…</span></span>
<span class="line"><span style="color:#A6ACCD;">pnpm i esbuild </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">D</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åœ¨å‘½ä»¤è¡Œä¸­è¾“å‡º</span></span>
<span class="line"><span style="color:#A6ACCD;">npx esbuild index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åœ¨æ–‡ä»¶ä¸­è¾“å‡º</span></span>
<span class="line"><span style="color:#A6ACCD;">npx esbuild index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">outfile</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">dist</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¾“å‡ºåˆ°æ–‡ä»¶å¤¹,æŒ‰ç…§åŸæ¥çš„æ–‡ä»¶å</span></span>
<span class="line"><span style="color:#A6ACCD;">npx esbuild index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">outdir</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">test</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ‰“åŒ…çš„æ“ä½œ</span></span>
<span class="line"><span style="color:#A6ACCD;">npx esbuild index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">outfile</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">dist</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">bundle</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç¼–è¯‘åˆ°node</span></span>
<span class="line"><span style="color:#A6ACCD;">npx esbuild index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">outfile</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">dist</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">platform</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">node</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¾“å‡ºæ ¼å¼ä¸ºcommonjs</span></span>
<span class="line"><span style="color:#A6ACCD;">npx esbuild index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">outfile</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">dist</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">platform</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">node </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">format</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">cjs</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç›‘å¬æ–‡ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">npx esbuild index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">outfile</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">dist</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">platform</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">node </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">format</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">cjs </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">watch</span></span></code></pre></div><h3 id="_4-9-esbuild-æ’ä»¶çš„å¼€å‘æ–¹å¼" tabindex="-1">4-9 Esbuild æ’ä»¶çš„å¼€å‘æ–¹å¼ <a class="header-anchor" href="#_4-9-esbuild-æ’ä»¶çš„å¼€å‘æ–¹å¼" aria-label="Permalink to &quot;4-9 Esbuild æ’ä»¶çš„å¼€å‘æ–¹å¼&quot;">â€‹</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> esbuild </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ’ä»¶åŠŸèƒ½çš„å®ç°</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> exampleOnLoadPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">example</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">build</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// onResolveä½œç”¨æ˜¯å‘Šè¯‰esbuildæŸä¸€ç±»æ–‡ä»¶æˆ‘ä»¬å¦‚ä½•å¤„ç†å®ƒ;è¿›è¡Œæ–‡ä»¶ç±»å‹çš„åŒºåˆ†</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">\.</span><span style="color:#C3E88D;">txt</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">txt</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// è¿”å›namespaceæ¥å‘Šè¯‰åç»­çš„æ’ä»¶æˆ‘ä»¬è¿™ä¸ªæ–‡ä»¶æ˜¯æ€æ ·çš„ç±»å‹</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// onLoadåªéœ€è¦å…³å¿ƒnamespaceä¸‹é¢txtçš„æ–‡ä»¶ï¼›å¯¹æ–‡ä»¶çš„å†…å®¹è¿›è¡Œå¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">\.</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">txt</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">text</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">promises</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// è¿™é‡Œçš„retrunä¼šå‘Šè¯‰esbuildè¯¥å¦‚ä½•å¤„ç†å®ƒ</span></span>
<span class="line"><span style="color:#F07178;">        contents</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">text</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">\s</span><span style="color:#89DDFF;">+/</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// contentséœ€è¦ç»è¿‡jsonè¿™ä¸ªloaderå»å¤„ç†æ‰èƒ½ç»™esbuildç”¨</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">initialOptions</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// é…ç½®é€‰é¡¹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">esbuild</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">bundle</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">outdir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">loader</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">.png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dataurl</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [exampleOnLoadPlugin]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">))</span></span></code></pre></div><h2 id="vite-æ’ä»¶ç³»ç»Ÿè¯¦è§£" tabindex="-1">Vite æ’ä»¶ç³»ç»Ÿè¯¦è§£ <a class="header-anchor" href="#vite-æ’ä»¶ç³»ç»Ÿè¯¦è§£" aria-label="Permalink to &quot;Vite æ’ä»¶ç³»ç»Ÿè¯¦è§£&quot;">â€‹</a></h2><h3 id="_5-1-vite-æ’ä»¶å¼€å‘æ¦‚è¿°" tabindex="-1">5-1 Vite æ’ä»¶å¼€å‘æ¦‚è¿° <a class="header-anchor" href="#_5-1-vite-æ’ä»¶å¼€å‘æ¦‚è¿°" aria-label="Permalink to &quot;5-1 Vite æ’ä»¶å¼€å‘æ¦‚è¿°&quot;">â€‹</a></h3><p>å‘½åè§„èŒƒï¼š</p><ul><li>rollup-plugin-xxxï¼šä½¿ç”¨ rollup ä»¥åŠ vite çš„æ’ä»¶</li><li>vite-plugin-xxxï¼šä»…ä»…åªæ˜¯æ”¯æŒ vite çš„æ’ä»¶</li></ul><p>åœ¨ dev-server å¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒä¼šè°ƒç”¨ options å’Œ buildStart è¿™ä¸¤ä¸ªé’©å­ ï¼Œä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œ æ–‡ä»¶æ›´æ–°ä¸ä¼šè°ƒç”¨ã€‚ æ¯ä¸ªæ¨¡å—ï¼šresolveldï¼Œloadï¼Œtransformï¼› åœ¨ dev-server å…³é—­æ—¶ï¼Œä¼šè°ƒç”¨ buildEnd å’Œ closeBundle è¿™ä¸¤ä¸ªé’©å­ã€‚ modulePased ä¸ä¼šè¢«è°ƒç”¨ï¼Œä¸ºäº†é˜²æ­¢ vite æ•´ä½“çš„å¯¹ä»£ç çš„å»æ‰§è¡Œä¸€ä¸ª AST çš„è§£æï¼ŒAST è§£ææ˜¯ä¸€ä¸ªæ¯”è¾ƒæ…¢çš„æ“ä½œï¼Œvite åœ¨å¼€å‘æ—¶ä»£ç æœ€ç»ˆç¼–è¯‘äº§å‡ºæ˜¯é€šè¿‡ esbuild æ¥åšçš„ï¼Œæ‰§è¡Œå®Œ rollup æ’ä»¶ä¼šä¼ ç»™ esbuild rollup æ’ä»¶å…¼å®¹ vite è¦ç¬¦åˆä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>æ²¡æœ‰ä½¿ç”¨ moduleParsed é’©å­</li><li>å®ƒåœ¨æ‰“åŒ…é’©å­å’Œè¾“å‡ºé’©å­ä¹‹é—´æ²¡æœ‰å¾ˆå¼ºçš„è€¦åˆ</li></ul><p>vite ç‹¬æœ‰çš„é’©å­ï¼š</p><ul><li>configï¼šç”¨äºæ’ä»¶å½“ä¸­æ ¹æ®å…¶ä»–çš„é…ç½®æ¥å»æ›´æ–°æ•´ä½“çš„ configï¼Œreturn çš„å¯¹è±¡è¢«åˆå¹¶åˆ°æ•´ä¸ª vite çš„ config å½“ä¸­</li><li>configResolvedï¼šæ‰€æœ‰çš„æ’ä»¶å¯¹åº”çš„ config éƒ½æ‰§è¡Œè¿‡ä¹‹åå¾—åˆ°ä¸€ä¸ªæœ€ç»ˆçš„ configï¼Œæ— æ³•æ›´æ”¹ã€‚</li><li>transformIndexHtmlï¼šå…¥å£çš„ html æ–‡ä»¶ï¼Œå¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°åšä¸€äº›æ“ä½œ</li><li>handleHotUpdateï¼šå»å¤„ç†çƒ­æ›´æ–°çš„æ—¶å€™å¯ä»¥åšä¸€äº›å¯¹äºè‡ªå·±ç‰¹æ®Šæ–‡ä»¶çš„ç‰¹æ€§å¤„ç†ï¼Œè®©çƒ­æ›´æ–°æ›´å…¨é¢å¼ºå¤§</li></ul><h3 id="_5-2-vite-æ’ä»¶çš„æ‰§è¡Œæ—¶æœº" tabindex="-1">5-2 Vite æ’ä»¶çš„æ‰§è¡Œæ—¶æœº <a class="header-anchor" href="#_5-2-vite-æ’ä»¶çš„æ‰§è¡Œæ—¶æœº" aria-label="Permalink to &quot;5-2 Vite æ’ä»¶çš„æ‰§è¡Œæ—¶æœº&quot;">â€‹</a></h3><p>vite å½“ä¸­æœ‰æ˜¯ä¸‰ä¸ªæ‰§è¡Œæ—¶æœº</p><ul><li>preï¼šæœ€å¿«è¢«æ‰§è¡Œçš„è¿™éƒ¨åˆ†æ’ä»¶</li><li>normalï¼švite çš„ä¸€äº›æ ¸å¿ƒæ’ä»¶</li><li>postï¼šæ˜¯åœ¨ vite çš„ build ä¹‹åï¼Œç”¨äºæ’ä»¶ä»£ç æ„å»ºçš„å·¥ä½œ</li></ul><p>vite çš„æ’ä»¶æ‰§è¡Œæ–‡ä»¶ç¼–è¯‘æ˜¯è¦æˆ‘ä»¬æœ‰è¯·æ±‚çš„æ—¶å€™å®ƒæ‰æ˜¯ç´¯ç´¯çš„å»ç¼–è¯‘ï¼Œè€Œä¸æ˜¯é¡¹ç›®ä¸€èµ·åŠ¨å°±å…¨éƒ¨ç¼–è¯‘ï¼Œä¸ç„¶å°±å˜å¾—åƒ webpack ä¸€å¯åŠ¨è¦ç­‰å¾ˆä¹…æ‰ä¼šçœŸæ­£çš„å¯åŠ¨å¼€å§‹ã€‚</p><h3 id="_5-3-vite-æ’ä»¶-api-è¯¦è§£" tabindex="-1">5-3 Vite æ’ä»¶ API è¯¦è§£ <a class="header-anchor" href="#_5-3-vite-æ’ä»¶-api-è¯¦è§£" aria-label="Permalink to &quot;5-3 Vite æ’ä»¶ API è¯¦è§£&quot;">â€‹</a></h3><p>configï¼š configResolvedï¼š configureServerï¼š transformIndexHtmlï¼š handleHotUpdateï¼š</p><h3 id="_5-4-hmr-api-è¯¦ç»†è§£æ-ä¸Š" tabindex="-1">5-4 HMR-API è¯¦ç»†è§£æï¼ˆä¸Šï¼‰ <a class="header-anchor" href="#_5-4-hmr-api-è¯¦ç»†è§£æ-ä¸Š" aria-label="Permalink to &quot;5-4 HMR-API è¯¦ç»†è§£æï¼ˆä¸Šï¼‰&quot;">â€‹</a></h3><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/wu_xianqiang/article/details/127713347" target="_blank" rel="noreferrer">Vite HMR API</a> æ¨¡å—çƒ­æ›¿æ¢ï¼ˆhot module replacementï¼‰çš„ç®€ç§°ï¼ŒæŒ‡çš„æ˜¯åœ¨åº”ç”¨è¿è¡Œçš„æ—¶å€™ï¼Œä¸éœ€è¦åˆ·æ–°é¡µé¢å°±å¯ä»¥ç›´æ¥æ›¿æ¢ã€å¢åˆ æ¨¡å—ã€‚vite çš„çƒ­æ›¿æ¢ webpack çš„å®ç°ç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ websocket å»ºç«‹æœåŠ¡ç«¯å’Œæµè§ˆå™¨çš„é€šä¿¡ï¼Œè¿™æ ·æ–‡ä»¶å‘ç”Ÿå˜åŠ¨å°±å¯ä»¥å®æ—¶ååº”åˆ°æµè§ˆå™¨ä¸­ã€‚ vite çš„çƒ­æ›´æ–°æ˜¯å’Œ webpack ä¸ä¸€æ ·çš„ï¼Œwebpack æ˜¯è®¾è®¡äº†ä¸€æ•´å¥—å«åšæ¨¡å—ä»£ç†çš„åŠŸèƒ½ã€‚vite æ˜¯åŸºäº esmodule åŠ è½½æ–¹å¼çš„ï¼Œå®ƒæ˜¯ä¸æ¨èå»åšæ¨¡å—ä»£ç†çš„æ–¹å¼å»å®ç° hmr çš„ apiã€‚ Vite é€šè¿‡ç‰¹æ®Šçš„ i<wbr>mport.meta.hot å¯¹è±¡æš´éœ²æ‰‹åŠ¨ HMR APIã€‚ å¿…éœ€çš„æ¡ä»¶å®ˆå«</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// é¦–å…ˆï¼Œè¯·ç¡®ä¿ç”¨ä¸€ä¸ªæ¡ä»¶è¯­å¥å®ˆæŠ¤æ‰€æœ‰ HMR API çš„ä½¿ç”¨ï¼Œè¿™æ ·ä»£ç å°±å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¢« tree-shaking ä¼˜åŒ–ï¼š</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// HMR ä»£ç </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>hot.accept(cb)ï¼šè¦æ¥æ”¶æ¨¡å—è‡ªèº«ï¼Œåº”ä½¿ç”¨ i<wbr>mport.meta.hot.acceptï¼Œå‚æ•°ä¸ºæ¥æ”¶å·²æ›´æ–°æ¨¡å—çš„å›è°ƒå‡½æ•°ï¼š</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> count </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accept</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newModule</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">updated: count is now </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_5-5-hmr-api-è¯¦ç»†è§£æ-ä¸‹" tabindex="-1">5-5 HMR-API è¯¦ç»†è§£æï¼ˆä¸‹ï¼‰ <a class="header-anchor" href="#_5-5-hmr-api-è¯¦ç»†è§£æ-ä¸‹" aria-label="Permalink to &quot;5-5 HMR-API è¯¦ç»†è§£æï¼ˆä¸‹ï¼‰&quot;">â€‹</a></h3><p>hot.dispose(cb)ï¼šä¸€ä¸ªæ¥æ”¶è‡ªèº«çš„æ¨¡å—æˆ–ä¸€ä¸ªæœŸæœ›è¢«å…¶ä»–æ¨¡å—æ¥æ”¶çš„æ¨¡å—å¯ä»¥ä½¿ç”¨ hot.dispose æ¥æ¸…é™¤ä»»ä½•ç”±å…¶æ›´æ–°å‰¯æœ¬äº§ç”Ÿçš„æŒä¹…å‰¯ä½œç”¨ï¼š</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">setupSideEffect</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setupSideEffect</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dispose</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ¸…ç†å‰¯ä½œç”¨</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_5-6-vite-vue3-jsx-æ’ä»¶æ¦‚è§ˆ" tabindex="-1">5-6 vite-vue3-jsx æ’ä»¶æ¦‚è§ˆ <a class="header-anchor" href="#_5-6-vite-vue3-jsx-æ’ä»¶æ¦‚è§ˆ" aria-label="Permalink to &quot;5-6 vite-vue3-jsx æ’ä»¶æ¦‚è§ˆ&quot;">â€‹</a></h3><p><a href="https://github.com/vitejs/vite/tree/v2/packages/plugin-vue-jsx" target="_blank" rel="noreferrer">https://github.com/vitejs/vite/tree/v2/packages/plugin-vue-jsx</a></p><h3 id="_5-7-vite-vue3-jsx-æ’ä»¶æºç è§£æä¹‹é…ç½®å’Œäº§å‡º" tabindex="-1">5-7 vite-vue3-jsx æ’ä»¶æºç è§£æä¹‹é…ç½®å’Œäº§å‡º <a class="header-anchor" href="#_5-7-vite-vue3-jsx-æ’ä»¶æºç è§£æä¹‹é…ç½®å’Œäº§å‡º" aria-label="Permalink to &quot;5-7 vite-vue3-jsx æ’ä»¶æºç è§£æä¹‹é…ç½®å’Œäº§å‡º&quot;">â€‹</a></h3><p>æºç ï¼š<a href="https://github.com/vitejs/vite/blob/v2/packages/plugin-vue-jsx/index.js" target="_blank" rel="noreferrer">https://github.com/vitejs/vite/blob/v2/packages/plugin-vue-jsx/index.js</a></p><h3 id="_5-8-vite-vue3-jsx-æ’ä»¶è¯¦è§£ä¹‹-hmr" tabindex="-1">5-8 vite-vue3-jsx æ’ä»¶è¯¦è§£ä¹‹ HMR <a class="header-anchor" href="#_5-8-vite-vue3-jsx-æ’ä»¶è¯¦è§£ä¹‹-hmr" aria-label="Permalink to &quot;5-8 vite-vue3-jsx æ’ä»¶è¯¦è§£ä¹‹ HMR&quot;">â€‹</a></h3><p>æºç ï¼š<a href="https://github.com/vitejs/vite/blob/v2/packages/plugin-vue-jsx/index.js" target="_blank" rel="noreferrer">https://github.com/vitejs/vite/blob/v2/packages/plugin-vue-jsx/index.js</a></p><h3 id="_5-9-vite-vue3-jsx-æ’ä»¶è§£æä¹‹-ssr" tabindex="-1">5-9 vite-vue3-jsx æ’ä»¶è§£æä¹‹ SSR <a class="header-anchor" href="#_5-9-vite-vue3-jsx-æ’ä»¶è§£æä¹‹-ssr" aria-label="Permalink to &quot;5-9 vite-vue3-jsx æ’ä»¶è§£æä¹‹ SSR&quot;">â€‹</a></h3><p>æºç ï¼š<a href="https://github.com/vitejs/vite/blob/v2/packages/plugin-vue-jsx/index.js" target="_blank" rel="noreferrer">https://github.com/vitejs/vite/blob/v2/packages/plugin-vue-jsx/index.js</a></p><h2 id="å®æˆ˜-vite-æ’ä»¶" tabindex="-1">å®æˆ˜ Vite æ’ä»¶ <a class="header-anchor" href="#å®æˆ˜-vite-æ’ä»¶" aria-label="Permalink to &quot;å®æˆ˜ Vite æ’ä»¶&quot;">â€‹</a></h2><h3 id="_6-1-ast-è¯­æ³•æ ‘ä»‹ç»" tabindex="-1">6-1 Ast è¯­æ³•æ ‘ä»‹ç» <a class="header-anchor" href="#_6-1-ast-è¯­æ³•æ ‘ä»‹ç»" aria-label="Permalink to &quot;6-1 Ast è¯­æ³•æ ‘ä»‹ç»&quot;">â€‹</a></h3><p>ä»£ç å…¶å®æ˜¯å†™ç»™äººçœ‹çš„ï¼Œæœºå™¨çœ‹ä¸æ‡‚ä»£ç ï¼Œä½†æ˜¯æœºå™¨å¯ä»¥è®¤è¯† Ast ç»“æ„ä½“ã€‚ <img src="https://raw.githubusercontent.com/zrtch/blog-img/master/1671608929746-768ee35f-e8ce-4682-9c69-7f4fdb73c7aa.jpeg" alt="ast.jpg"></p><h3 id="_6-2-mdx-è¯­æ³•ä»‹ç»å’Œæ’ä»¶è®¾è®¡" tabindex="-1">6-2 MDX è¯­æ³•ä»‹ç»å’Œæ’ä»¶è®¾è®¡ <a class="header-anchor" href="#_6-2-mdx-è¯­æ³•ä»‹ç»å’Œæ’ä»¶è®¾è®¡" aria-label="Permalink to &quot;6-2 MDX è¯­æ³•ä»‹ç»å’Œæ’ä»¶è®¾è®¡&quot;">â€‹</a></h3><p>å®˜ç½‘ï¼š<a href="https://mdxjs.com/" target="_blank" rel="noreferrer">https://mdxjs.com/</a> MDX = MD + JSX -&gt; JSXï¼›å°±æ˜¯ markdown åŠ ä¸Š JSX ç„¶åæœ€åæŠŠè¿™äº›ä¹¦å†™çš„å†…å®¹ç»™ä»–ç»Ÿä¸€è½¬æ¢æˆ JSXï¼Œå°±æ˜¯åœ¨ markdown åŸºç¡€ä¸Šäº†åŠ ä¸Šäº† JSã€‚ å¦‚ä½•å®ç°ï¼šæŠŠ MDX Code é€šè¿‡ MDX æ’ä»¶è½¬æˆä¸€ä¸ª JSX çš„è¯­æ³•ï¼Œè¿™ä¸ª JSX å¯ä»¥æ˜¯ Vue çš„ä¹Ÿå¯ä»¥æ˜¯ react çš„ã€‚</p><h3 id="_6-3-mdx-çš„ä½¿ç”¨ä»¥åŠ-mdx-loader-çš„åŸç†" tabindex="-1">6-3 MDX çš„ä½¿ç”¨ä»¥åŠ mdx-loader çš„åŸç† <a class="header-anchor" href="#_6-3-mdx-çš„ä½¿ç”¨ä»¥åŠ-mdx-loader-çš„åŸç†" aria-label="Permalink to &quot;6-3 MDX çš„ä½¿ç”¨ä»¥åŠ mdx-loader çš„åŸç†&quot;">â€‹</a></h3><p>å®‰è£…<code>pnpm i @mdx-js/mdx -D</code> require æŠ¥é”™è§£å†³æ–¹å¼ï¼šè¿™æ˜¯ç”±äºä» node.js 14 ç‰ˆåŠä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œrequire ä½œä¸º COMMONJS çš„ä¸€ä¸ªå‘½ä»¤å·²ä¸å†ç›´æ¥æ”¯æŒä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¼å…¥ createRequire å‘½ä»¤æ‰å¯ä»¥</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createRequire</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> require </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url)</span></span></code></pre></div><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æ–°å»ºtest-mdx.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createRequire</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> require </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mdx </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@mdx-js/mdx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(mdx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sync</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"># Hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¿è¡Œ node test-mdx.js å°±ä¼šè¾“å‡ºä»¥ä¸‹ä»£ç ï¼Œå°±æ˜¯jsxçš„æ–‡ä»¶</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/* @jsx mdx */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> makeShortcode </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MDXDefaultShortcode</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">warn</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Component </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> was not imported, exported, or provided by MDXProvider as global scope</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> {...</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">} /&gt;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> layoutProps </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> MDXLayout </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">wrapper</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MDXContent</span><span style="color:#89DDFF;">({</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">components</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">})</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">MDXLayout</span></span>
<span class="line"><span style="color:#89DDFF;">      {...</span><span style="color:#A6ACCD;">layoutProps</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      {...</span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">components</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">components</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#C792EA;">mdxType</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MDXLayout</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">    &gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;{</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">`</span><span style="color:#89DDFF;">}&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#FFCB6B;">MDXLayout</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">MDXContent</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">isMDXComponent </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span></code></pre></div><h3 id="_6-4-mdx-å¦‚ä½•é…åˆ-react-ä½¿ç”¨" tabindex="-1">6-4 MDX å¦‚ä½•é…åˆ React ä½¿ç”¨ <a class="header-anchor" href="#_6-4-mdx-å¦‚ä½•é…åˆ-react-ä½¿ç”¨" aria-label="Permalink to &quot;6-4 MDX å¦‚ä½•é…åˆ React ä½¿ç”¨&quot;">â€‹</a></h3><p><a href="https://github.com/jxnblk/mdx-deck" target="_blank" rel="noreferrer">https://github.com/jxnblk/mdx-deck</a></p></div></div></main><footer class="VPDocFooter" data-v-e031c361 data-v-6b942b4b><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"daa3c81d\",\"fe_problem_vue.md\":\"e362d8df\",\"fe_default_html.md\":\"0de334e5\",\"fe_problem_react.md\":\"fa4b315e\",\"fe_default_index.md\":\"078b45d4\",\"fe_article_books.md\":\"9528a2de\",\"fe_resource_tool.md\":\"2f07a62c\",\"fe_my_index.md\":\"27cda473\",\"fe_article_index.md\":\"6e196762\",\"fe_resource_index.md\":\"a354045e\",\"fe_default_css.md\":\"2e64329e\",\"fe_engineering_vite.md\":\"d4ff8168\",\"fe_default_js.md\":\"6755e755\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"cn-ZH\",\"dir\":\"ltr\",\"title\":\"ğŸ’ Cherryçš„åšå®¢\",\"description\":\"ğŸ’ Cherryçš„åšå®¢\",\"base\":\"/Cherry-blog/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"ğŸ’ Cherryçš„åšå®¢\",\"outlineTitle\":\"å¿«é€Ÿå¯¼èˆª\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/zrtch\"}],\"docFooter\":{\"prev\":\"ä¸Šä¸€ç¯‡\",\"next\":\"ä¸‹ä¸€ç¯‡\"},\"nav\":[{\"text\":\"å‰ç«¯åŸºç¡€\",\"link\":\"/fe/default/html.md\"},{\"text\":\"å·¥ç¨‹åŒ–\",\"link\":\"/fe/engineering/vite.md\"},{\"text\":\"èµ„æºåˆé›†\",\"link\":\"/fe/resource/index.md\"}],\"sidebar\":{\"/fe/default\":[{\"text\":\"HTML / CSS\",\"items\":[{\"text\":\"HTML åŸºç¡€çŸ¥è¯†\",\"link\":\"/fe/default/html.md\"},{\"text\":\"CSS åŸºç¡€çŸ¥è¯†\",\"link\":\"/fe/default/css.md\"}]},{\"text\":\"JavaScript åŸºç¡€çŸ¥è¯†\",\"items\":[{\"text\":\"JavaScript\",\"link\":\"/fe/default/js.md\"}]}],\"/fe/engineering\":[{\"text\":\"å·¥ç¨‹åŒ–\",\"items\":[{\"text\":\"Vite\",\"link\":\"/fe/engineering/vite.md\"}]}],\"/fe/problem\":[{\"text\":\"Vue\",\"link\":\"/fe/problem/vue.md\"},{\"text\":\"React\",\"link\":\"/fe/problem/react.md\"}],\"/fe/resource\":[{\"text\":\"å¸¸ç”¨ç½‘ç«™\",\"link\":\"/fe/resource/index.md\"},{\"text\":\"å·¥å…·åˆé›†\",\"link\":\"/fe/resource/tool.md\"}],\"/fe/article\":[{\"text\":\"æ–‡ç« åˆé›†\",\"link\":\"/fe/article/index.md\"},{\"text\":\"ä¹¦ç±åˆé›†\",\"link\":\"/fe/article/books.md\"}]}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>